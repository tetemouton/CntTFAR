"TV" = c(4,5),
"WF" = c(5), # Ignored the minute sliver in 4
"WS" = c(5),
"VU" = c(5))
bet_reg_lst <- list("AS" = c(6), # Ignored the minute sliver in 4
"CK" = c(4,6),
"FJ" = c(6), # Ignored the minute sliver in 4
"FM" = c(1,3,7,8),
"GU" = c(1),
"KI" = c(3,4,6),
"MH" = c(1,2,3,4),
"NC" = c(5,6),
"NR" = c(3),
"NU" = c(6),
"PF" = c(6),
"PG" = c(3,5,8),
"PW" = c(7),
"SB" = c(3,4,5,8),
"TK" = c(4,6),
"TO" = c(6),
"TV" = c(4,6),
"WF" = c(6), # Ignored the minute sliver in 4
"WS" = c(6),
"VU" = c(5,6))
base_pth <- "./"
alb_rep <- read.MFCLRep("./Data/ALB/plot-final3.par.rep")
bet_rep <- read.MFCLRep("./Data/BET/plot-09.par.rep")
skj_rep <- read.MFCLRep("./Data/SKJ/plot-09.par.rep")
yft_rep <- read.MFCLRep("./Data/YFT/plot-14.par.rep")
skj_reg_lst
plot_regional_depletion <- function(rep = skj_rep, reg_lst = skj_reg_lst, cnt = "CK", spp = "skj"){
cnt_reg <- reg_lst[[cnt]]
sb <- rep@adultBiomass
sbf0 <- rep@adultBiomass_nofish
dep <- sb/sbf0
dep_yr <- as.data.frame(dep) %>% mutate(qtr = as.numeric(season)/4 - .125, yrqtr = year + qtr, region = paste("Region", area)) %>%
group_by(year, area, region) %>% summarise(data = mean(data))
dep_yr$fcl_reg <- ifelse(as.numeric(dep_yr$area) %in% cnt_reg, "focal", "other")
sub_dat <- filter(dep_yr, fcl_reg == "focal")
windows(3000,2000)
pl <- ggplot(dep_yr, aes(x = year, y = data)) + geom_line(linewidth = 1) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) + facet_wrap(~ region, ncol = 3) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("sb/sbf=0") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
print(pl)
savePlot(paste0("Figures/", cnt, "/regional_depletion_", spp, ".png"), type="png")
dev.off()
}
map(cnt_vec, plot_regional_depletion, rep = skj_rep, reg_lst = skj_reg_lst, spp = "skj")
plot_regional_depletion <- function(rep = skj_rep, reg_lst = skj_reg_lst, cnt = "CK", spp = "skj"){
cnt_reg <- reg_lst[[cnt]]
sb <- rep@adultBiomass
sbf0 <- rep@adultBiomass_nofish
dep <- sb/sbf0
dep_yr <- as.data.frame(dep) %>% mutate(qtr = as.numeric(season)/4 - .125, yrqtr = year + qtr, region = paste("Region", area)) %>%
group_by(year, area, region) %>% summarise(data = mean(data))
dep_yr$fcl_reg <- ifelse(as.numeric(dep_yr$area) %in% cnt_reg, "focal", "other")
sub_dat <- filter(dep_yr, fcl_reg == "focal")
windows(3000,2000)
pl <- ggplot(dep_yr, aes(x = year, y = data)) + geom_line(linewidth = 1) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) + facet_wrap(~ region, ncol = 3) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("sb/sbf=0") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
print(pl)
savePlot(paste0("Figures/", cnt, "/regional_depletion_", spp, ".png"), type="png")
dev.off()
}
map(cnt_vec, plot_regional_depletion, rep = skj_rep, reg_lst = skj_reg_lst, spp = "skj")
map(cnt_vec, plot_regional_depletion, rep = bet_rep, reg_lst = bet_reg_lst, spp = "bet")
map(cnt_vec, plot_regional_depletion, rep = yft_rep, reg_lst = yft_reg_lst, spp = "yft")
map(cnt_vec, plot_regional_depletion, rep = alb_rep, reg_lst = alb_reg_lst, spp = "alb")
wcpfc_dat <- read.csv(file = "./Data/Ann_All-Gear_Cat_Effort_Flg_5x5_AllOceans.csv", header = TRUE)
ez_dat <- read.csv(file = "./Data/Ann_Cat_EEZ_ACE.csv", header = TRUE)
yb_dat <- read.csv(file = "./Data/Ann_Cat_Oceans_YB_ACE.csv", header = TRUE)
# Convert 5x5 coordinates into number and add 2.5 to put in cell centre for assignment to assessment regions
wcpfc_dat %<>% mutate(lat = as.numeric(str_sub(lat_short,end = -2)), lon = as.numeric(str_sub(lon_short,end = -2)),
lat_hem = str_sub(lat_short,start = -1), lon_hem = str_sub(lon_short,start = -1),
lat = ifelse(lat_hem == "S", -lat, lat) + 2.5, lon = ifelse(lon_hem == "W", 360 - lon, lon) + 2.5)
wcpfc_dat %<>% mutate(reg_yft = NA,
reg_yft = ifelse(lat > 20 & lat < 50 & Lon > 120 & Lon < 210, 1, reg_yft),
reg_yft = ifelse(lat > 10 & lat < 20 & Lon > 140 & Lon < 210, 1, reg_yft),
reg_yft = ifelse(lat > -10 & lat < 20 & Lon > 110 & Lon < 140, 2, reg_yft),
reg_yft = ifelse(lat > -10 & lat < 0 & Lon > 140 & Lon < 155, 3, reg_yft),
reg_yft = ifelse(lat > -10 & lat < -5 & Lon > 155 & Lon < 160, 3, reg_yft),
reg_yft = ifelse(lat > 0 & lat < 10 & Lon > 140 & Lon < 210, 4, reg_yft),
reg_yft = ifelse(lat > -5 & lat < 0 & Lon > 155 & Lon < 210, 4, reg_yft),
reg_yft = ifelse(lat > -10 & lat < -5 & Lon > 160 & Lon < 210, 4, reg_yft),
reg_yft = ifelse(lat > -40 & lat < -10 & Lon > 140 & Lon < 210, 5, reg_yft))
wcpfc_dat <- read.csv(file = "./Data/Ann_All-Gear_Cat_Effort_Flg_5x5_AllOceans.csv", header = TRUE)
ez_dat <- read.csv(file = "./Data/Ann_Cat_EEZ_ACE.csv", header = TRUE)
yb_dat <- read.csv(file = "./Data/Ann_Cat_Oceans_YB_ACE.csv", header = TRUE)
# Convert 5x5 coordinates into number and add 2.5 to put in cell centre for assignment to assessment regions
wcpfc_dat %<>% mutate(lat = as.numeric(str_sub(lat_short,end = -2)), lon = as.numeric(str_sub(lon_short,end = -2)),
lat_hem = str_sub(lat_short,start = -1), lon_hem = str_sub(lon_short,start = -1),
lat = ifelse(lat_hem == "S", -lat, lat) + 2.5, lon = ifelse(lon_hem == "W", 360 - lon, lon) + 2.5)
head(wcpfc_dat)
table(wcpfc_dat$lon)
wcpfc_dat %<>% mutate(reg_yft = NA,
reg_yft = ifelse(lat > 20 & lat < 50 & lon > 120 & lon < 210, 1, reg_yft),
reg_yft = ifelse(lat > 10 & lat < 20 & lon > 140 & lon < 210, 1, reg_yft),
reg_yft = ifelse(lat > -10 & lat < 20 & lon > 110 & lon < 140, 2, reg_yft),
reg_yft = ifelse(lat > -10 & lat < 0 & lon > 140 & lon < 155, 3, reg_yft),
reg_yft = ifelse(lat > -10 & lat < -5 & lon > 155 & lon < 160, 3, reg_yft),
reg_yft = ifelse(lat > 0 & lat < 10 & lon > 140 & lon < 210, 4, reg_yft),
reg_yft = ifelse(lat > -5 & lat < 0 & lon > 155 & lon < 210, 4, reg_yft),
reg_yft = ifelse(lat > -10 & lat < -5 & lon > 160 & lon < 210, 4, reg_yft),
reg_yft = ifelse(lat > -40 & lat < -10 & lon > 140 & lon < 210, 5, reg_yft))
wcpfc_dat %<>% mutate(reg_bet = NA,
reg_bet = ifelse(lat > 20 & lat < 50 & lon > 120 & lon < 170, 1, reg_bet),
reg_bet = ifelse(lat > 10 & lat < 20 & lon > 140 & lon < 170, 1, reg_bet),
reg_bet = ifelse(lat > 10 & lat < 50 & lon > 170 & lon < 210, 2, reg_bet),
reg_bet = ifelse(lat > 0 & lat < 10 & lon > 140 & lon < 170, 3, reg_bet),
reg_bet = ifelse(lat > -5 & lat < 0 & lon > 155 & lon < 170, 3, reg_bet),
reg_bet = ifelse(lat > -10 & lat < -5 & lon > 160 & lon < 170, 3, reg_bet),
reg_bet = ifelse(lat > -10 & lat < 10 & lon > 170 & lon < 210, 4, reg_bet),
reg_bet = ifelse(lat > -40 & lat < -10 & lon > 140 & lon < 170, 5, reg_bet), # This includes 9 but gets overwritten
reg_bet = ifelse(lat > -40 & lat < -10 & lon > 170 & lon < 210, 6, reg_bet),
reg_bet = ifelse(lat > -10 & lat < 20 & lon > 110 & lon < 140, 7, reg_bet),
reg_bet = ifelse(lat > -10 & lat < 0 & lon > 140 & lon < 155, 8, reg_bet),
reg_bet = ifelse(lat > -10 & lat < -5 & lon > 155 & lon < 160, 8, reg_bet),
reg_bet = ifelse(lat > -20 & lat < -15 & lon > 140 & lon < 150, 9, reg_bet))
wcpfc_dat %<>% mutate(reg_skj = NA,
reg_skj = ifelse(lat > 30 & lat < 50 & lon > 120 & lon < 140, 1, reg_skj),
reg_skj = ifelse(lat > 30 & lat < 35 & lon > 140 & lon < 145, 1, reg_skj),
reg_skj = ifelse(lat > 35 & lat < 50 & lon > 140 & lon < 145, 2, reg_skj),
reg_skj = ifelse(lat > 30 & lat < 50 & lon > 145 & lon < 210, 2, reg_skj),
reg_skj = ifelse(lat > 20 & lat < 30 & lon > 120 & lon < 130, 3, reg_skj),
reg_skj = ifelse(lat > 10 & lat < 30 & lon > 130 & lon < 145, 3, reg_skj),
reg_skj = ifelse(lat > 10 & lat < 30 & lon > 145 & lon < 210, 4, reg_skj),
reg_skj = ifelse(lat > -20 & lat < 20 & lon > 110 & lon < 130, 5, reg_skj),
reg_skj = ifelse(lat > -20 & lat < 10 & lon > 130 & lon < 140, 5, reg_skj),
reg_skj = ifelse(lat > -20 & lat < -5 & lon > 155 & lon < 160, 6, reg_skj),
reg_skj = ifelse(lat > -20 & lat < 0 & lon > 140 & lon < 155, 6, reg_skj),
reg_skj = ifelse(lat > 0 & lat < 10 & lon > 140 & lon < 170, 7, reg_skj),
reg_skj = ifelse(lat > -5 & lat < 0 & lon > 155 & lon < 160, 7, reg_skj),
reg_skj = ifelse(lat > -20 & lat < 0 & lon > 160 & lon < 170, 7, reg_skj),
reg_skj = ifelse(lat > -20 & lat < 10 & lon > 170 & lon < 210, 8, reg_skj))
wcpfc_dat %<>% mutate(reg_alb = NA,
reg_alb = ifelse(lat > -10 & lat < 0 & lon > 140 & lon < 210, 1, reg_alb),
reg_alb = ifelse(lat > -10 & lat < 0 & lon > 210 & lon < 230, 1, reg_alb),
reg_alb = ifelse(lat > -25 & lat < -10 & lon > 210 & lon < 230, 2, reg_alb),
reg_alb = ifelse(lat > -50 & lat < -25 & lon > 210 & lon < 230, 3, reg_alb),
reg_alb = ifelse(lat > -5 & lat < 0 & lon > 215 & lon < 230, 4, reg_alb),
reg_alb = ifelse(lat > -50 & lat < 0 & lon > 230 & lon < 290, 4, reg_alb))
table(wcpfc_dat$reg_alb,useNA="always")
table(wcpfc_dat$gr_id,useNA="always")
reg_df <- rbind(c('WCPFC-CA catch', round(sum(sx_tab$ALB)), round(wc_tot[, c("BET","SKJ","YFT")])),
c('5-year WCPFC-CA catch trend', 'Stable','Decreasing','Stable','Increasing'),
c('WCPFC-CA Longline catch', round(sx_tab[sx_tab$gear == "L", "ALB"]), round(wc_tab[wc_tab$gear == "L", c("BET","SKJ","YFT")])),
c('WCPFC-CA Purse seine catch', round(sx_tab[sx_tab$gear == "S", "ALB"]), round(wc_tab[wc_tab$gear == "S", c("BET","SKJ","YFT")])),
c('WCPFC-CA Pole and line catch', round(sx_tab[sx_tab$gear == "P", "ALB"]), round(wc_tab[wc_tab$gear == "P", c("BET","SKJ","YFT")])),
c('WCPFC-CA Other catch', round(sx_tab[sx_tab$gear == "Other", "ALB"]), round(wc_tab[wc_tab$gear == "Other", c("BET","SKJ","YFT")]))
)
wc_tab <- yb_dat %>% filter(ocean_id == "WX", between(yy, lst_yr - 4, lst_yr)) %>% mutate(gear = ifelse(!gr_id %in% c("L","P","S"), "Other", gr_id)) %>%
group_by(yy, gear) %>% summarise(ALB = sum(alb_c), BET = sum(bet_c), SKJ = sum(skj_c), YFT = sum(yft_c)) %>%
group_by(gear) %>% summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
sx_tab <- yb_dat %>% filter(ocean_id == "SX", between(yy, lst_yr - 4, lst_yr)) %>% mutate(gear = ifelse(!gr_id %in% c("L","P","S"), "Other", gr_id)) %>%
group_by(yy, gear) %>% summarise(ALB = sum(alb_c)) %>% group_by(gear) %>% summarise(ALB = mean(ALB))
wc_tot <- yb_dat %>% filter(ocean_id == "WX", between(yy, lst_yr - 4, lst_yr)) %>% group_by(yy) %>%
summarise(ALB = sum(alb_c), BET = sum(bet_c), SKJ = sum(skj_c), YFT = sum(yft_c)) %>%
summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
reg_df <- rbind(c('WCPFC-CA catch', round(sum(sx_tab$ALB)), round(wc_tot[, c("BET","SKJ","YFT")])),
c('5-year WCPFC-CA catch trend', 'Stable','Decreasing','Stable','Increasing'),
c('WCPFC-CA Longline catch', round(sx_tab[sx_tab$gear == "L", "ALB"]), round(wc_tab[wc_tab$gear == "L", c("BET","SKJ","YFT")])),
c('WCPFC-CA Purse seine catch', round(sx_tab[sx_tab$gear == "S", "ALB"]), round(wc_tab[wc_tab$gear == "S", c("BET","SKJ","YFT")])),
c('WCPFC-CA Pole and line catch', round(sx_tab[sx_tab$gear == "P", "ALB"]), round(wc_tab[wc_tab$gear == "P", c("BET","SKJ","YFT")])),
c('WCPFC-CA Other catch', round(sx_tab[sx_tab$gear == "Other", "ALB"]), round(wc_tab[wc_tab$gear == "Other", c("BET","SKJ","YFT")]))
)
reg_df
names(ref_df)
names(reg_df)
colnames(reg_df)
colnames(reg_df) <- c("Summary description","Albacore","Bigeye","Skipjack","Yellowfin")
reg_df
cnt = "CK"
skj_reg_lst[[cnt]]
wc_tab
sx_tab
wc_tot
alb_reg <- alb_reg_lst[[cnt]]
alb_reg
reg_dat_alb <- wcpfc_dat %>% filter(reg_alb %in% alb_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c)) %>%
summarise(ALB = mean(ALB))
reg_dat_alb
yft_reg
alb_reg <- alb_reg_lst[[cnt]]
bet_reg <- bet_reg_lst[[cnt]]
skj_reg <- skj_reg_lst[[cnt]]
yft_reg <- yft_reg_lst[[cnt]]
yft_reg
reg_dat_yft <- wcpfc_dat %>% filter(reg_yft %in% yft_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(YFT = sum(sum_yft_c)) %>% summarise(YFT = mean(YFT))
reg_dat_yft
reg_dat_alb <- wcpfc_dat %>% filter(reg_alb %in% alb_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c)) %>% summarise(ALB = mean(ALB)) # Not sure we need the 2 summarise functions?
reg_dat_bet <- wcpfc_dat %>% filter(reg_bet %in% bet_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(BET = sum(sum_bet_c)) %>% summarise(BET = mean(BET))
reg_dat_skj <- wcpfc_dat %>% filter(reg_skj %in% skj_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(SKJ = sum(sum_skj_c)) %>% summarise(SKJ = mean(SKJ))
reg_dat_yft <- wcpfc_dat %>% filter(reg_yft %in% yft_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(YFT = sum(sum_yft_c)) %>% summarise(YFT = mean(YFT))
reg_dat_skj
cnt
reg_dat_bet
c(paste('Catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft)
full_df <- rbind(reg_df,
c(paste('Catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft),
c(paste('Catch in', cnt, 'EEZ'), round(ez_stat[1,])),
c(paste('Catch by', cnt, 'flagged in WCPFC-CA'), round(flg_stat[1,])),
c(paste('Percent of WCPFC-CA catch by', cnt, 'flagged vessels'), round(flg_stat[1,]/reg_df[1, 2:5]*100, 1))
reg_df
full_df <- rbind(reg_df,
c(paste('Catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft),
c(paste('Catch in', cnt, 'EEZ'), round(ez_stat[1,])),
c(paste('Catch by', cnt, 'flagged in WCPFC-CA'), round(flg_stat[1,])),
c(paste('Percent of WCPFC-CA catch by', cnt, 'flagged vessels'), round(flg_stat[1,]/reg_df[1, 2:5]*100, 1))
)
get_cnt_catches <- function(cnt = "CK"){
alb_reg <- alb_reg_lst[[cnt]]
bet_reg <- bet_reg_lst[[cnt]]
skj_reg <- skj_reg_lst[[cnt]]
yft_reg <- yft_reg_lst[[cnt]]
ez_stat <- ez_dat %>% filter(ez_id == cnt, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c), BET = sum(sum_bet_c), SKJ = sum(sum_skj_c), YFT = sum(sum_yft_c)) %>%
summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
flg_stat <- ez_dat %>% filter(flag_id == cnt, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c), BET = sum(sum_bet_c), SKJ = sum(sum_skj_c), YFT = sum(sum_yft_c)) %>%
summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
reg_dat_alb <- wcpfc_dat %>% filter(reg_alb %in% alb_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c)) %>% summarise(ALB = mean(ALB)) # Not sure we need the 2 summarise functions?
reg_dat_bet <- wcpfc_dat %>% filter(reg_bet %in% bet_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(BET = sum(sum_bet_c)) %>% summarise(BET = mean(BET))
reg_dat_skj <- wcpfc_dat %>% filter(reg_skj %in% skj_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(SKJ = sum(sum_skj_c)) %>% summarise(SKJ = mean(SKJ))
reg_dat_yft <- wcpfc_dat %>% filter(reg_yft %in% yft_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(YFT = sum(sum_yft_c)) %>% summarise(YFT = mean(YFT))
full_df <- rbind(reg_df,
c(paste('Catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft),
c(paste('Catch in', cnt, 'EEZ'), round(ez_stat[1,])),
c(paste('Catch by', cnt, 'flagged in WCPFC-CA'), round(flg_stat[1,])),
c(paste('Percent of WCPFC-CA catch by', cnt, 'flagged vessels'), round(flg_stat[1,]/reg_df[1, 2:5]*100, 1))
)
alb_reg <- alb_reg_lst[[cnt]]
bet_reg <- bet_reg_lst[[cnt]]
skj_reg <- skj_reg_lst[[cnt]]
yft_reg <- yft_reg_lst[[cnt]]
ez_stat <- ez_dat %>% filter(ez_id == cnt, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c), BET = sum(sum_bet_c), SKJ = sum(sum_skj_c), YFT = sum(sum_yft_c)) %>%
summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
flg_stat <- ez_dat %>% filter(flag_id == cnt, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c), BET = sum(sum_bet_c), SKJ = sum(sum_skj_c), YFT = sum(sum_yft_c)) %>%
summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
reg_dat_alb <- wcpfc_dat %>% filter(reg_alb %in% alb_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c)) %>% summarise(ALB = mean(ALB)) # Not sure we need the 2 summarise functions?
reg_dat_bet <- wcpfc_dat %>% filter(reg_bet %in% bet_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(BET = sum(sum_bet_c)) %>% summarise(BET = mean(BET))
reg_dat_skj <- wcpfc_dat %>% filter(reg_skj %in% skj_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(SKJ = sum(sum_skj_c)) %>% summarise(SKJ = mean(SKJ))
reg_dat_yft <- wcpfc_dat %>% filter(reg_yft %in% yft_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(YFT = sum(sum_yft_c)) %>% summarise(YFT = mean(YFT))
full_df <- rbind(reg_df,
c(paste('Catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft),
c(paste('Catch in', cnt, 'EEZ'), round(ez_stat[1,])),
c(paste('Catch by', cnt, 'flagged in WCPFC-CA'), round(flg_stat[1,])),
c(paste('Percent of WCPFC-CA catch by', cnt, 'flagged vessels'), round(flg_stat[1,]/reg_df[1, 2:5]*100, 1))
)
full_df
reg_dat_alb <- wcpfc_dat %>% filter(reg_alb %in% alb_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c)) %>% summarise(ALB = round(mean(ALB))) # Not sure we need the 2 summarise functions?
reg_dat_bet <- wcpfc_dat %>% filter(reg_bet %in% bet_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(BET = sum(sum_bet_c)) %>% summarise(BET = round(mean(BET)))
reg_dat_skj <- wcpfc_dat %>% filter(reg_skj %in% skj_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(SKJ = sum(sum_skj_c)) %>% summarise(SKJ = round(mean(SKJ)))
reg_dat_yft <- wcpfc_dat %>% filter(reg_yft %in% yft_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(YFT = sum(sum_yft_c)) %>% summarise(YFT = round(mean(YFT)))
full_df <- rbind(reg_df,
c(paste('Catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft),
c(paste('Catch in', cnt, 'EEZ'), round(ez_stat[1,])),
c(paste('Catch by', cnt, 'flagged in WCPFC-CA'), round(flg_stat[1,])),
c(paste('Percent of WCPFC-CA catch by', cnt, 'flagged vessels'), round(flg_stat[1,]/reg_df[1, 2:5]*100, 1))
)
full_df
full_df <- rbind(reg_df,
c(paste('Catch in', cnt, 'model regions'), round(reg_dat_alb/reg_df[1, 2]*100, 1),
round(reg_dat_bet/reg_df[1, 3]*100, 1),
round(reg_dat_skj/reg_df[1, 4]*100, 1),
round(reg_dat_yft/reg_df[1, 5]*100, 1)),
c(paste('Percent of WCPFC-CA catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft),
c(paste('Catch in', cnt, 'EEZ'), round(ez_stat[1,])),
c(paste('Catch by', cnt, 'flagged in WCPFC-CA'), round(flg_stat[1,])),
c(paste('Percent of WCPFC-CA catch by', cnt, 'flagged vessels'), round(flg_stat[1,]/reg_df[1, 2:5]*100, 1))
)
full_df
full_df <- rbind(reg_df,
c(paste('Catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft),
c(paste('Percent of WCPFC-CA catch in', cnt, 'model regions'),
round(reg_dat_alb/reg_df[1, 2]*100, 1),
round(reg_dat_bet/reg_df[1, 3]*100, 1),
round(reg_dat_skj/reg_df[1, 4]*100, 1),
round(reg_dat_yft/reg_df[1, 5]*100, 1)),
c(paste('Catch in', cnt, 'EEZ'), round(ez_stat[1,])),
c(paste('Catch by', cnt, 'flagged in WCPFC-CA'), round(flg_stat[1,])),
c(paste('Percent of WCPFC-CA catch by', cnt, 'flagged vessels'), round(flg_stat[1,]/reg_df[1, 2:5]*100, 1))
)
full_df
15446/64480
ez_stat[1,]
full_df <- rbind(reg_df,
c(paste('Catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft),
c(paste('Percent of WCPFC-CA catch in', cnt, 'model regions'),
round(reg_dat_alb/reg_df[1, 2]*100, 1),
round(reg_dat_bet/reg_df[1, 3]*100, 1),
round(reg_dat_skj/reg_df[1, 4]*100, 1),
round(reg_dat_yft/reg_df[1, 5]*100, 1)),
c(paste('Catch in', cnt, 'EEZ'), round(ez_stat[1,])),
c(paste('Percent of WCPFC-CA catch taken in', cnt, 'EEZ'), round(ez_stat[1,]/reg_df[1, 2:5]*100, 1)),
c(paste('Catch by', cnt, 'flagged in WCPFC-CA'), round(flg_stat[1,])),
c(paste('Percent of WCPFC-CA catch by', cnt, 'flagged vessels'), round(flg_stat[1,]/reg_df[1, 2:5]*100, 1))
)
full_df
get_cnt_catches <- function(cnt = "CK"){
alb_reg <- alb_reg_lst[[cnt]]
bet_reg <- bet_reg_lst[[cnt]]
skj_reg <- skj_reg_lst[[cnt]]
yft_reg <- yft_reg_lst[[cnt]]
ez_stat <- ez_dat %>% filter(ez_id == cnt, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c), BET = sum(sum_bet_c), SKJ = sum(sum_skj_c), YFT = sum(sum_yft_c)) %>%
summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
flg_stat <- ez_dat %>% filter(flag_id == cnt, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c), BET = sum(sum_bet_c), SKJ = sum(sum_skj_c), YFT = sum(sum_yft_c)) %>%
summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
reg_dat_alb <- wcpfc_dat %>% filter(reg_alb %in% alb_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c)) %>% summarise(ALB = round(mean(ALB))) # Not sure we need the 2 summarise functions?
reg_dat_bet <- wcpfc_dat %>% filter(reg_bet %in% bet_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(BET = sum(sum_bet_c)) %>% summarise(BET = round(mean(BET)))
reg_dat_skj <- wcpfc_dat %>% filter(reg_skj %in% skj_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(SKJ = sum(sum_skj_c)) %>% summarise(SKJ = round(mean(SKJ)))
reg_dat_yft <- wcpfc_dat %>% filter(reg_yft %in% yft_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(YFT = sum(sum_yft_c)) %>% summarise(YFT = round(mean(YFT)))
full_df <- rbind(reg_df,
c(paste('Catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft),
c(paste('Percent of WCPFC-CA catch in', cnt, 'model regions'),
round(reg_dat_alb/reg_df[1, 2]*100, 1),
round(reg_dat_bet/reg_df[1, 3]*100, 1),
round(reg_dat_skj/reg_df[1, 4]*100, 1),
round(reg_dat_yft/reg_df[1, 5]*100, 1)),
c(paste('Catch in', cnt, 'EEZ'), round(ez_stat[1,])),
c(paste('Percent of WCPFC-CA catch taken in', cnt, 'EEZ'), round(ez_stat[1,]/reg_df[1, 2:5]*100, 1)),
c(paste('Catch by', cnt, 'flagged in WCPFC-CA'), round(flg_stat[1,])),
c(paste('Percent of WCPFC-CA catch by', cnt, 'flagged vessels'), round(flg_stat[1,]/reg_df[1, 2:5]*100, 1))
)
df_write <-apply(full_df, 2, as.character)
write.csv(df_write, file = (paste0("Figures/", cnt, "/", "catch_summary_table.csv")), row.names = FALSE)
# xtable(df_write, elthethethe)
}
map(cnt_vec, get_cnt_catches)
head(ez_stat)
head(ez_dat)
table(ez_dat$ez_id)
ez_dat <- read.csv(file = "./Data/Ann_Cat_EEZ_ACE.csv", header = TRUE)
table(ez_dat$ez_id)
ez_dat <- read.csv(file = "./Data/Ann_Cat_EEZ_ACE.csv", header = TRUE) %>%
mutate(ez_id = recode(ez_id, NF = "AU", GL = "KI", LN = "KI", PX = "KI", MA = "NC"))
table(ez_dat$ez_id)
566+3+258+362
wcpfc_dat <- read.csv(file = "./Data/Ann_All-Gear_Cat_Effort_Flg_5x5_AllOceans.csv", header = TRUE)
ez_dat <- read.csv(file = "./Data/Ann_Cat_EEZ_ACE.csv", header = TRUE) %>%
mutate(ez_id = recode(ez_id, NF = "AU", GL = "KI", LN = "KI", PX = "KI", MA = "NC"))
yb_dat <- read.csv(file = "./Data/Ann_Cat_Oceans_YB_ACE.csv", header = TRUE)
# Convert 5x5 coordinates into number and add 2.5 to put in cell centre for assignment to assessment regions
wcpfc_dat %<>% mutate(lat = as.numeric(str_sub(lat_short,end = -2)), lon = as.numeric(str_sub(lon_short,end = -2)),
lat_hem = str_sub(lat_short,start = -1), lon_hem = str_sub(lon_short,start = -1),
lat = ifelse(lat_hem == "S", -lat, lat) + 2.5, lon = ifelse(lon_hem == "W", 360 - lon, lon) + 2.5)
wcpfc_dat %<>% mutate(reg_yft = NA,
reg_yft = ifelse(lat > 20 & lat < 50 & lon > 120 & lon < 210, 1, reg_yft),
reg_yft = ifelse(lat > 10 & lat < 20 & lon > 140 & lon < 210, 1, reg_yft),
reg_yft = ifelse(lat > -10 & lat < 20 & lon > 110 & lon < 140, 2, reg_yft),
reg_yft = ifelse(lat > -10 & lat < 0 & lon > 140 & lon < 155, 3, reg_yft),
reg_yft = ifelse(lat > -10 & lat < -5 & lon > 155 & lon < 160, 3, reg_yft),
reg_yft = ifelse(lat > 0 & lat < 10 & lon > 140 & lon < 210, 4, reg_yft),
reg_yft = ifelse(lat > -5 & lat < 0 & lon > 155 & lon < 210, 4, reg_yft),
reg_yft = ifelse(lat > -10 & lat < -5 & lon > 160 & lon < 210, 4, reg_yft),
reg_yft = ifelse(lat > -40 & lat < -10 & lon > 140 & lon < 210, 5, reg_yft))
wcpfc_dat %<>% mutate(reg_bet = NA,
reg_bet = ifelse(lat > 20 & lat < 50 & lon > 120 & lon < 170, 1, reg_bet),
reg_bet = ifelse(lat > 10 & lat < 20 & lon > 140 & lon < 170, 1, reg_bet),
reg_bet = ifelse(lat > 10 & lat < 50 & lon > 170 & lon < 210, 2, reg_bet),
reg_bet = ifelse(lat > 0 & lat < 10 & lon > 140 & lon < 170, 3, reg_bet),
reg_bet = ifelse(lat > -5 & lat < 0 & lon > 155 & lon < 170, 3, reg_bet),
reg_bet = ifelse(lat > -10 & lat < -5 & lon > 160 & lon < 170, 3, reg_bet),
reg_bet = ifelse(lat > -10 & lat < 10 & lon > 170 & lon < 210, 4, reg_bet),
reg_bet = ifelse(lat > -40 & lat < -10 & lon > 140 & lon < 170, 5, reg_bet), # This includes 9 but gets overwritten
reg_bet = ifelse(lat > -40 & lat < -10 & lon > 170 & lon < 210, 6, reg_bet),
reg_bet = ifelse(lat > -10 & lat < 20 & lon > 110 & lon < 140, 7, reg_bet),
reg_bet = ifelse(lat > -10 & lat < 0 & lon > 140 & lon < 155, 8, reg_bet),
reg_bet = ifelse(lat > -10 & lat < -5 & lon > 155 & lon < 160, 8, reg_bet),
reg_bet = ifelse(lat > -20 & lat < -15 & lon > 140 & lon < 150, 9, reg_bet))
wcpfc_dat %<>% mutate(reg_skj = NA,
reg_skj = ifelse(lat > 30 & lat < 50 & lon > 120 & lon < 140, 1, reg_skj),
reg_skj = ifelse(lat > 30 & lat < 35 & lon > 140 & lon < 145, 1, reg_skj),
reg_skj = ifelse(lat > 35 & lat < 50 & lon > 140 & lon < 145, 2, reg_skj),
reg_skj = ifelse(lat > 30 & lat < 50 & lon > 145 & lon < 210, 2, reg_skj),
reg_skj = ifelse(lat > 20 & lat < 30 & lon > 120 & lon < 130, 3, reg_skj),
reg_skj = ifelse(lat > 10 & lat < 30 & lon > 130 & lon < 145, 3, reg_skj),
reg_skj = ifelse(lat > 10 & lat < 30 & lon > 145 & lon < 210, 4, reg_skj),
reg_skj = ifelse(lat > -20 & lat < 20 & lon > 110 & lon < 130, 5, reg_skj),
reg_skj = ifelse(lat > -20 & lat < 10 & lon > 130 & lon < 140, 5, reg_skj),
reg_skj = ifelse(lat > -20 & lat < -5 & lon > 155 & lon < 160, 6, reg_skj),
reg_skj = ifelse(lat > -20 & lat < 0 & lon > 140 & lon < 155, 6, reg_skj),
reg_skj = ifelse(lat > 0 & lat < 10 & lon > 140 & lon < 170, 7, reg_skj),
reg_skj = ifelse(lat > -5 & lat < 0 & lon > 155 & lon < 160, 7, reg_skj),
reg_skj = ifelse(lat > -20 & lat < 0 & lon > 160 & lon < 170, 7, reg_skj),
reg_skj = ifelse(lat > -20 & lat < 10 & lon > 170 & lon < 210, 8, reg_skj))
wcpfc_dat %<>% mutate(reg_alb = NA,
reg_alb = ifelse(lat > -10 & lat < 0 & lon > 140 & lon < 210, 1, reg_alb),
reg_alb = ifelse(lat > -10 & lat < 0 & lon > 210 & lon < 230, 1, reg_alb),
reg_alb = ifelse(lat > -25 & lat < -10 & lon > 210 & lon < 230, 2, reg_alb),
reg_alb = ifelse(lat > -50 & lat < -25 & lon > 210 & lon < 230, 3, reg_alb),
reg_alb = ifelse(lat > -5 & lat < 0 & lon > 215 & lon < 230, 4, reg_alb),
reg_alb = ifelse(lat > -50 & lat < 0 & lon > 230 & lon < 290, 4, reg_alb))
# Assign yearbook data to ocean areas, particularly to separate SPA south Pacific from WCPFC-CA ("WX")
wc_tab <- yb_dat %>% filter(ocean_id == "WX", between(yy, lst_yr - 4, lst_yr)) %>% mutate(gear = ifelse(!gr_id %in% c("L","P","S"), "Other", gr_id)) %>%
group_by(yy, gear) %>% summarise(ALB = sum(alb_c), BET = sum(bet_c), SKJ = sum(skj_c), YFT = sum(yft_c)) %>%
group_by(gear) %>% summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
sx_tab <- yb_dat %>% filter(ocean_id == "SX", between(yy, lst_yr - 4, lst_yr)) %>% mutate(gear = ifelse(!gr_id %in% c("L","P","S"), "Other", gr_id)) %>%
group_by(yy, gear) %>% summarise(ALB = sum(alb_c)) %>% group_by(gear) %>% summarise(ALB = mean(ALB))
wc_tot <- yb_dat %>% filter(ocean_id == "WX", between(yy, lst_yr - 4, lst_yr)) %>% group_by(yy) %>%
summarise(ALB = sum(alb_c), BET = sum(bet_c), SKJ = sum(skj_c), YFT = sum(yft_c)) %>%
summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
reg_df <- rbind(c('WCPFC-CA catch', round(sum(sx_tab$ALB)), round(wc_tot[, c("BET","SKJ","YFT")])),
c('5-year WCPFC-CA catch trend', 'Stable','Decreasing','Stable','Increasing'),
c('WCPFC-CA Longline catch', round(sx_tab[sx_tab$gear == "L", "ALB"]), round(wc_tab[wc_tab$gear == "L", c("BET","SKJ","YFT")])),
c('WCPFC-CA Purse seine catch', round(sx_tab[sx_tab$gear == "S", "ALB"]), round(wc_tab[wc_tab$gear == "S", c("BET","SKJ","YFT")])),
c('WCPFC-CA Pole and line catch', round(sx_tab[sx_tab$gear == "P", "ALB"]), round(wc_tab[wc_tab$gear == "P", c("BET","SKJ","YFT")])),
c('WCPFC-CA Other catch', round(sx_tab[sx_tab$gear == "Other", "ALB"]), round(wc_tab[wc_tab$gear == "Other", c("BET","SKJ","YFT")]))
)
# Need to note in table footnote that this is just Sth Pacific Albacore
colnames(reg_df) <- c("Summary description","Albacore","Bigeye","Skipjack","Yellowfin")
get_cnt_catches <- function(cnt = "CK"){
alb_reg <- alb_reg_lst[[cnt]]
bet_reg <- bet_reg_lst[[cnt]]
skj_reg <- skj_reg_lst[[cnt]]
yft_reg <- yft_reg_lst[[cnt]]
ez_stat <- ez_dat %>% filter(ez_id == cnt, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c), BET = sum(sum_bet_c), SKJ = sum(sum_skj_c), YFT = sum(sum_yft_c)) %>%
summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
flg_stat <- ez_dat %>% filter(flag_id == cnt, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c), BET = sum(sum_bet_c), SKJ = sum(sum_skj_c), YFT = sum(sum_yft_c)) %>%
summarise(ALB = mean(ALB), BET = mean(BET), SKJ = mean(SKJ), YFT = mean(YFT))
reg_dat_alb <- wcpfc_dat %>% filter(reg_alb %in% alb_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(ALB = sum(sum_alb_c)) %>% summarise(ALB = round(mean(ALB))) # Not sure we need the 2 summarise functions?
reg_dat_bet <- wcpfc_dat %>% filter(reg_bet %in% bet_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(BET = sum(sum_bet_c)) %>% summarise(BET = round(mean(BET)))
reg_dat_skj <- wcpfc_dat %>% filter(reg_skj %in% skj_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(SKJ = sum(sum_skj_c)) %>% summarise(SKJ = round(mean(SKJ)))
reg_dat_yft <- wcpfc_dat %>% filter(reg_yft %in% yft_reg, between(yy, lst_yr - 4, lst_yr)) %>%
group_by(yy) %>% summarise(YFT = sum(sum_yft_c)) %>% summarise(YFT = round(mean(YFT)))
full_df <- rbind(reg_df,
c(paste('Catch in', cnt, 'model regions'), reg_dat_alb, reg_dat_bet, reg_dat_skj, reg_dat_yft),
c(paste('Percent of WCPFC-CA catch in', cnt, 'model regions'),
round(reg_dat_alb/reg_df[1, 2]*100, 1),
round(reg_dat_bet/reg_df[1, 3]*100, 1),
round(reg_dat_skj/reg_df[1, 4]*100, 1),
round(reg_dat_yft/reg_df[1, 5]*100, 1)),
c(paste('Catch in', cnt, 'EEZ'), round(ez_stat[1,])),
c(paste('Percent of WCPFC-CA catch taken in', cnt, 'EEZ'), round(ez_stat[1,]/reg_df[1, 2:5]*100, 1)),
c(paste('Catch by', cnt, 'flagged in WCPFC-CA'), round(flg_stat[1,])),
c(paste('Percent of WCPFC-CA catch by', cnt, 'flagged vessels'), round(flg_stat[1,]/reg_df[1, 2:5]*100, 1))
)
df_write <-apply(full_df, 2, as.character)
write.csv(df_write, file = (paste0("Figures/", cnt, "/", "catch_summary_table.csv")), row.names = FALSE)
# xtable(df_write, elthethethe)
}
map(cnt_vec, get_cnt_catches)
791/721
39.3/32.1
11.1/9
3/12
20653*.04
36384/.92
1.54/1.52*6000
1.3/1.28*6000
20750*.2
20750*.205
library(ggplot2)
library(magrittr)
library(tidyverse)
library(ggthemes)
base_pth <- "C:/Albacore_Catch_Modelling/"
ls_dat <- read.csv(file = paste0(base_pth, "Data/ls_data_tufman_fj.csv"), header = TRUE)
ace_dat <- read.csv(file = paste0(base_pth, "Data/ace_eez_LL_a-yb-ez.csv"), header = TRUE)
load(paste0(base_pth, "Data/vms_day_dat_fj.RData"), verbose = TRUE) # Object is vms_dat
# Filter VMS data
vms_mod <- vms_dat %>% filter(log_act_code == "F") %>% mutate(lub_date = ymd(vms_date), year = year(lub_date)) # Only keep fishing records, ymd is very useful (lubridate package)
# Filter logsheet data
ls_fish <- ls_dat %>% filter(l_activity_id == 1)
head(ls_fish)
library(ggplot2)
library(magrittr)
library(tidyverse)
library(ggthemes)
base_pth <- "C:/Albacore_Catch_Modelling/"
ls_dat <- read.csv(file = paste0(base_pth, "Data/ls_data_tufman_fj.csv"), header = TRUE)
ace_dat <- read.csv(file = paste0(base_pth, "Data/ace_eez_LL_a-yb-ez.csv"), header = TRUE)
load(paste0(base_pth, "Data/vms_day_dat_fj.RData"), verbose = TRUE) # Object is vms_dat
# Filter VMS data
vms_mod <- vms_dat %>% filter(log_act_code == "F") %>% mutate(lub_date = ymd(vms_date), year = year(lub_date)) # Only keep fishing records, ymd is very useful (lubridate package)
# Filter logsheet data
ls_fish <- ls_dat %>% filter(l_activity_id == 1)
# Get number of sets by vessels per year - note that this data is 1 row per set
ves_set <- ls_fish %>% group_by(year, vessel_id) %>% summarise(Nset = n()) %>% arrange(year, -Nset) %>% mutate(ves = row_number())
