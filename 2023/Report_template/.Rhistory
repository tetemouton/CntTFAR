cnt_pl$Flag <- factor(cnt_pl$Flag, levels = c("Other","BZ","CN","JP","KR","TW","US","SB","KI","CK","FJ","VU"))
windows(4000,2000)
pl1 <- ggplot(cnt_pl, aes(x = factor(Year), y = Catch, fill = Flag)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("dodgerblue2","#E31A1C","green4","#6A3D9A","#FF7F00","black","gold1","skyblue2","#FB9A99", "darkturquoise",
"#CAB2D6",  "#FDBF6F","gray70","khaki2","maroon","orchid1","deeppink1","blue1","steelblue4"), 0.5)) + guides(fill = guide_legend(nrow = 2, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl1)
pl2 <- ggplot(cnt_pl, aes(x = factor(Year), y = Catch, fill = Flag)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("dodgerblue2","#E31A1C","green4","#6A3D9A","#FF7F00","black","gold1","skyblue2","#FB9A99", "darkturquoise",
"#CAB2D6",  "#FDBF6F","gray70","khaki2","maroon","orchid1","deeppink1","blue1","steelblue4"), 0.5)) + guides(fill = guide_legend(nrow = 2, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl2)
ffa_pl <- eez_hs %>% group_by(Year, Grp) %>% summarise(Catch = sum(Catch))
ffa_pl$Grp <- factor(ffa_pl$Grp, levels = c("Other","FFA"))
pl3 <- ggplot(ffa_pl, aes(x = factor(Year), y = Catch, fill = Grp)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl3)
pl4 <- ggplot(ffa_pl, aes(x = factor(Year), y = Catch, fill = Grp)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl4)
spg_pl <- eez_s %>% group_by(Year, Spg) %>% summarise(Catch = sum(Catch))
spg_pl$Spg <- factor(spg_pl$Spg, levels = c("Other","SPG"))
pl5 <- ggplot(spg_pl, aes(x = factor(Year), y = Catch, fill = Spg)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl5)
pl6 <- ggplot(spg_pl, aes(x = factor(Year), y = Catch, fill = Spg)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl6)
dev.off()
windows(5000,3000)
plot_grid(pl1, pl2, pl3, pl4, labels = "", ncol = 2)
savePlot(paste0(dir_pth, "Output/HighSeas_Catch_Breakdown_By_Flag.png"), type="png")
dev.off()
windows(5000,4000)
plot_grid(pl1, pl2, pl3, pl4, pl5, pl6, labels = "", ncol = 2)
savePlot(paste0(dir_pth, "Output/HighSeas_Catch_Breakdown_By_Flag_SPG.png"), type="png")
dev.off()
eez_hs
table(eez_hs$Gear)
dat_hs_flg <- eez_hs %>% select(Year,Flag,Catch)
dat_hs_flg
# This is the data.frame corresponding to Table 1 of the report - Longline catches by EEZ
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider()
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch)
dat_hs_flg
# This is the data.frame corresponding to Table 1 of the report - Longline catches by EEZ
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider(names_from = Flag, values_from = Catch)
dat_hs_flg
theme_set(theme_bw())
dir_pth <- "C:/South_Pacific_Albacore/7th_FFA_ALB_Workshop_Oct23/ALB_Catch_Summaries/"
lastyr <- 2022
#____________________________________________________________________________________________________________
dat <- read.csv(file = paste0(dir_pth, "/Data/Ann_Cat_EEZ_ACE.csv"), header = TRUE)
cnt <- c("AS","AU","CK","FJ","PF","KI","MA","NF","NC","NZ","NU","PG","WF","WS","SB","TK","TO","TV","VU","H4","H5","I2","I5","I7",
"I8","I9","LN","PX","GL","JV","HB","PT","HS")
IW <- c("H4","H5","I2","I5","I7","I8","I9")
ffa <- c("AU","CK","FJ","KI","NZ","NU","PG","WS","SB","TK","TO","TV","VU")
fra <- c("PF","MA","NC","WF")
us <- c("AS","JV","HB")
spg <- c("CK","FJ","NU","TO","VU","WS")
ez_code <- read.csv(file = paste0(dir_pth, "Data/country_codes.csv"))
#_______________________________________________________________________________
# Summary table of catches by EEZ without archipelagic waters - should match (apart from data updates) with Table 1 of alb trends paper
eez_dat_early <- dat %>% rename(Year = yy, EEZ = ez_id, Flag = flag_id, Gear = gr_id) %>% filter(Year >= 2000, Year <= lastyr) %>%
mutate(EEZ = recode(EEZ, NF = "AU", GL = "KI", LN = "KI", PX = "KI", H4 = "HS", H5 = "HS", I2 = "HS", I5 = "HS", I7 = "HS", I8 = "HS", I9 = "HS")) %>%
group_by(Year, EEZ, Flag, Gear, in_arch) %>% summarise(Catch = sum(sum_alb_c))
eez_dat <- filter(eez_dat_early, Year >= 2000)
eez_dat_L <- eez_dat %>% filter(Gear == "L") %>% group_by(Year, EEZ, in_arch) %>% summarise(Catch = round(sum(Catch))) %>% arrange(desc(in_arch), EEZ)
eez_dat_L_w <- eez_dat_L %>% pivot_wider(names_from = Year, values_from = Catch)
# This is the data.frame corresponding to Table 1 of the report - Longline catches by EEZ
eez_dat_L_sth_NoAW <- eez_dat_L_w %>% filter(!in_arch, EEZ %in% cnt) %>% select(-in_arch) %>%
mutate(EEZ = ez_code$country[match(EEZ, ez_code$country_code)])
eez_dat_L_sth_NoAW[is.na(eez_dat_L_sth_NoAW)] <- 0
eez_dat_L_sth_NoAW %<>% ungroup %>% add_row(EEZ = "Total", summarise(., across(where(is.numeric), sum))) %>% as.data.frame()
write.csv(eez_dat_L_sth_NoAW, file = paste0(dir_pth, "Data/LL_Catch_EEZ_ALL_Summary_NoArchWaters.csv"), row.names = FALSE)
#_______________________________________________________________________________
# Summary table of catches by EEZ with archipelagic waters - will therefore be slightly higher than Table 1 of alb trends paper
eez_dat_L <- eez_dat %>% filter(Gear == "L") %>% group_by(Year, EEZ) %>% summarise(Catch = round(sum(Catch))) %>% arrange(EEZ)
eez_dat_L_w <- eez_dat_L %>% pivot_wider(names_from = Year, values_from = Catch)
# This is the data.frame corresponding to Table 1 of the report - Longline catches by EEZ
eez_dat_L_sth <- eez_dat_L_w %>% filter(EEZ %in% cnt) %>%
mutate(EEZ = ez_code$country[match(EEZ, ez_code$country_code)])
eez_dat_L_sth[is.na(eez_dat_L_sth)] <- 0
eez_dat_L_sth %<>% ungroup %>% add_row(EEZ = "Total", summarise(., across(where(is.numeric), sum))) %>% as.data.frame()
write.csv(eez_dat_L_sth, file = paste0(dir_pth, "Data/LL_Catch_EEZ_ALL_Summary_WithArchWaters.csv"), row.names = FALSE)
#_______________________________________________________________________________
# Summary table of catches by flag by EEZ without archipelagic waters
eez_dat_L_flg <- eez_dat %>% filter(!in_arch, Gear == "L") %>% group_by(Year, EEZ, Flag) %>% summarise(Catch = round(sum(Catch))) %>%
arrange(EEZ, Flag)
eez_dat_L_w_flg <- eez_dat_L_flg %>% pivot_wider(names_from = Year, values_from = Catch)
# This is the data.frame corresponding to Table A1.2 of the report - Longline catches by EEZ
eez_dat_L_sth_NoAW_flg <- eez_dat_L_w_flg %>% filter(EEZ %in% cnt) %>%
mutate(EEZ = ez_code$country[match(EEZ, ez_code$country_code)])
eez_dat_L_sth_NoAW_flg[is.na(eez_dat_L_sth_NoAW_flg)] <- 0
eez_dat_L_sth_NoAW_flg %<>% group_by(EEZ) %>% mutate(EEZ = ifelse(row_number() == 1, EEZ, ""))
eez_dat_L_sth_NoAW_flg %<>% mutate(EEZ = ifelse(EEZ == "Matthew and Hunter", "Mthw-Hunter", EEZ),
EEZ = ifelse(EEZ == "Wallis and Futuna", "Wal-Futuna", EEZ),
EEZ = ifelse(EEZ == "French Polynesia", "F. Polynesia", EEZ),
EEZ = ifelse(EEZ == "American Samoa", "Am. Samoa", EEZ),
EEZ = ifelse(EEZ == "Solomon Islands", "Solomon Is.", EEZ))
#eez_dat_L_sth_NoAW_flg %<>% select(-'2010',-'2011')
write.csv(eez_dat_L_sth_NoAW_flg, file = paste0(dir_pth, "Data/LL_Catch_EEZ-By-Flag_ALL_Summary_NoArchWaters.csv"), row.names = FALSE)
#_______________________________________________________________________________
eez_s <- eez_dat_early %>% filter(EEZ %in% cnt, Gear == "L") %>%
mutate(Grp = case_when(EEZ %in% ffa ~ "FFA",
EEZ %in% fra ~ "French",
EEZ %in% us ~ "US",
.default = "High seas"),
Spg = ifelse(EEZ %in% spg, "SPG", "Other"))
ffa_pl <- eez_s %>% group_by(Year, Grp) %>% summarise(Catch = sum(Catch))
ffa_pl$Grp <- factor(ffa_pl$Grp, levels = c("French","US","High seas","FFA"))
windows(4000,2000)
pl1 <- ggplot(ffa_pl, aes(x = factor(Year), y = Catch, fill = Grp)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("goldenrod2","darkorchid","firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl1)
pl2 <- ggplot(ffa_pl, aes(x = factor(Year), y = Catch, fill = Grp)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("goldenrod2","darkorchid","firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl2)
spg_pl <- eez_s %>% group_by(Year, Spg) %>% summarise(Catch = sum(Catch))
spg_pl$Spg <- factor(spg_pl$Spg, levels = c("Other","SPG"))
pl3 <- ggplot(spg_pl, aes(x = factor(Year), y = Catch, fill = Spg)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("firebrick","navy","goldenrod2","darkorchid"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl3)
pl4 <- ggplot(spg_pl, aes(x = factor(Year), y = Catch, fill = Spg)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("firebrick","navy","goldenrod2","darkorchid"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl4)
dev.off()
windows(5000,3000)
plot_grid(pl1, pl2, pl3, pl4, labels = "", ncol = 2)
savePlot(paste0(dir_pth, "Output/Zone_Catch_Breakdown.png"), type="png")
dev.off()
#_______________________________________________________________________________
eez_hs <- eez_dat_early %>% filter(EEZ == "HS", Gear == "L") %>%
mutate(Grp = case_when(Flag %in% ffa ~ "FFA",
.default = "Other"),
Spg = ifelse(Flag %in% spg, "SPG", "Other"))
tmp <- eez_hs %>% group_by(Flag) %>% summarise(Catch = sum(Catch)) %>% arrange(desc(Catch))
cnt_pl <- eez_hs %>% mutate(Flag = ifelse(Flag %in% tmp$Flag[1:11], Flag, "Other")) %>% group_by(Year, Flag) %>% summarise(Catch = sum(Catch))
cnt_pl$Flag <- factor(cnt_pl$Flag, levels = c("Other","BZ","CN","JP","KR","TW","US","SB","KI","CK","FJ","VU"))
windows(4000,2000)
pl1 <- ggplot(cnt_pl, aes(x = factor(Year), y = Catch, fill = Flag)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("dodgerblue2","#E31A1C","green4","#6A3D9A","#FF7F00","black","gold1","skyblue2","#FB9A99", "darkturquoise",
"#CAB2D6",  "#FDBF6F","gray70","khaki2","maroon","orchid1","deeppink1","blue1","steelblue4"), 0.5)) + guides(fill = guide_legend(nrow = 2, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl1)
pl2 <- ggplot(cnt_pl, aes(x = factor(Year), y = Catch, fill = Flag)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("dodgerblue2","#E31A1C","green4","#6A3D9A","#FF7F00","black","gold1","skyblue2","#FB9A99", "darkturquoise",
"#CAB2D6",  "#FDBF6F","gray70","khaki2","maroon","orchid1","deeppink1","blue1","steelblue4"), 0.5)) + guides(fill = guide_legend(nrow = 2, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl2)
# This is the data.frame corresponding to Table 1 of the report - Longline catches by EEZ
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider(names_from = Flag, values_from = Catch)
dat_hs_flg
dat_hs_flg[is.na(dat_hs_flg)] <- 0
dat_hs_flg
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider(names_from = Flag, values_from = Catch)
dat_hs_flg[is.na(dat_hs_flg)] <- 0
dat_hs_flg %<>% ungroup %>% add_row(EEZ = "Total", summarise(., across(where(is.numeric), sum))) %>% as.data.frame()
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider(names_from = Flag, values_from = Catch)
dat_hs_flg[is.na(dat_hs_flg)] <- 0
dat_hs_flg
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider(names_from = Year, values_from = Catch)
dat_hs_flg[is.na(dat_hs_flg)] <- 0
dat_hs_flg %<>% ungroup %>% add_row(EEZ = "Total", summarise(., across(where(is.numeric), sum))) %>% as.data.frame()
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider(names_from = Year, values_from = Catch)
dat_hs_flg[is.na(dat_hs_flg)] <- 0
dat_hs_flg
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider(names_from = Year, values_from = Catch)
dat_hs_flg
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider(names_from = Year, values_from = Catch) %>%
mutate(Flag = ez_code$country[match(Flag, ez_code$country_code)])
dat_hs_flg
dat_hs_flg[is.na(dat_hs_flg)] <- 0
dat_hs_flg %<>% ungroup %>% add_row(Flag = "Total", summarise(., across(where(is.numeric), sum))) %>% as.data.frame()
write.csv(dat_hs_flg, file = paste0(dir_pth, "Output/LL_Catch_Highseas_By_Flag.csv"), row.names = FALSE)
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider(names_from = Year, values_from = Catch)
table(dat_hs_flg$Flag)
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% pivot_wider(names_from = Year, values_from = Catch) %>%
mutate(Flag = ez_code$country[match(Flag, ez_code$country_code)], Catch = round(Catch))
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% mutate(Catch = round(Catch)) %>%
pivot_wider(names_from = Year, values_from = Catch) %>%
mutate(Flag = ez_code$country[match(Flag, ez_code$country_code)])
dat_hs_flg[is.na(dat_hs_flg)] <- 0
dat_hs_flg %<>% ungroup %>% add_row(Flag = "Total", summarise(., across(where(is.numeric), sum))) %>% as.data.frame()
write.csv(dat_hs_flg, file = paste0(dir_pth, "Output/LL_Catch_Highseas_By_Flag.csv"), row.names = FALSE)
theme_set(theme_bw())
dir_pth <- "C:/South_Pacific_Albacore/7th_FFA_ALB_Workshop_Oct23/ALB_Catch_Summaries/"
lastyr <- 2022
#____________________________________________________________________________________________________________
dat <- read.csv(file = paste0(dir_pth, "/Data/Ann_Cat_EEZ_ACE.csv"), header = TRUE)
cnt <- c("AS","AU","CK","FJ","PF","KI","MA","NF","NC","NZ","NU","PG","WF","WS","SB","TK","TO","TV","VU","H4","H5","I2","I5","I7",
"I8","I9","LN","PX","GL","JV","HB","PT","HS")
IW <- c("H4","H5","I2","I5","I7","I8","I9")
ffa <- c("AU","CK","FJ","KI","NZ","NU","PG","WS","SB","TK","TO","TV","VU")
fra <- c("PF","MA","NC","WF")
us <- c("AS","JV","HB")
spg <- c("CK","FJ","NU","TO","VU","WS")
ez_code <- read.csv(file = paste0(dir_pth, "Data/country_codes.csv"))
#_______________________________________________________________________________
# Summary table of catches by EEZ without archipelagic waters - should match (apart from data updates) with Table 1 of alb trends paper
eez_dat_early <- dat %>% rename(Year = yy, EEZ = ez_id, Flag = flag_id, Gear = gr_id) %>% filter(Year >= 2000, Year <= lastyr) %>%
mutate(EEZ = recode(EEZ, NF = "AU", GL = "KI", LN = "KI", PX = "KI", H4 = "HS", H5 = "HS", I2 = "HS", I5 = "HS", I7 = "HS", I8 = "HS", I9 = "HS")) %>%
group_by(Year, EEZ, Flag, Gear, in_arch) %>% summarise(Catch = sum(sum_alb_c))
eez_dat <- filter(eez_dat_early, Year >= 2000)
eez_dat_L <- eez_dat %>% filter(Gear == "L") %>% group_by(Year, EEZ, in_arch) %>% summarise(Catch = round(sum(Catch))) %>% arrange(desc(in_arch), EEZ)
eez_dat_L_w <- eez_dat_L %>% pivot_wider(names_from = Year, values_from = Catch)
# This is the data.frame corresponding to Table 1 of the report - Longline catches by EEZ
eez_dat_L_sth_NoAW <- eez_dat_L_w %>% filter(!in_arch, EEZ %in% cnt) %>% select(-in_arch) %>%
mutate(EEZ = ez_code$country[match(EEZ, ez_code$country_code)])
eez_dat_L_sth_NoAW[is.na(eez_dat_L_sth_NoAW)] <- 0
eez_dat_L_sth_NoAW %<>% ungroup %>% add_row(EEZ = "Total", summarise(., across(where(is.numeric), sum))) %>% as.data.frame()
write.csv(eez_dat_L_sth_NoAW, file = paste0(dir_pth, "Output/LL_Catch_EEZ_ALL_Summary_NoArchWaters.csv"), row.names = FALSE)
#_______________________________________________________________________________
# Summary table of catches by EEZ with archipelagic waters - will therefore be slightly higher than Table 1 of alb trends paper
eez_dat_L <- eez_dat %>% filter(Gear == "L") %>% group_by(Year, EEZ) %>% summarise(Catch = round(sum(Catch))) %>% arrange(EEZ)
eez_dat_L_w <- eez_dat_L %>% pivot_wider(names_from = Year, values_from = Catch)
# This is the data.frame corresponding to Table 1 of the report - Longline catches by EEZ
eez_dat_L_sth <- eez_dat_L_w %>% filter(EEZ %in% cnt) %>%
mutate(EEZ = ez_code$country[match(EEZ, ez_code$country_code)])
eez_dat_L_sth[is.na(eez_dat_L_sth)] <- 0
eez_dat_L_sth %<>% ungroup %>% add_row(EEZ = "Total", summarise(., across(where(is.numeric), sum))) %>% as.data.frame()
write.csv(eez_dat_L_sth, file = paste0(dir_pth, "Output/LL_Catch_EEZ_ALL_Summary_WithArchWaters.csv"), row.names = FALSE)
#_______________________________________________________________________________
# Summary table of catches by flag by EEZ without archipelagic waters
eez_dat_L_flg <- eez_dat %>% filter(!in_arch, Gear == "L") %>% group_by(Year, EEZ, Flag) %>% summarise(Catch = round(sum(Catch))) %>%
arrange(EEZ, Flag)
eez_dat_L_w_flg <- eez_dat_L_flg %>% pivot_wider(names_from = Year, values_from = Catch)
# This is the data.frame corresponding to Table A1.2 of the report - Longline catches by EEZ
eez_dat_L_sth_NoAW_flg <- eez_dat_L_w_flg %>% filter(EEZ %in% cnt) %>%
mutate(EEZ = ez_code$country[match(EEZ, ez_code$country_code)])
eez_dat_L_sth_NoAW_flg[is.na(eez_dat_L_sth_NoAW_flg)] <- 0
eez_dat_L_sth_NoAW_flg %<>% group_by(EEZ) %>% mutate(EEZ = ifelse(row_number() == 1, EEZ, ""))
eez_dat_L_sth_NoAW_flg %<>% mutate(EEZ = ifelse(EEZ == "Matthew and Hunter", "Mthw-Hunter", EEZ),
EEZ = ifelse(EEZ == "Wallis and Futuna", "Wal-Futuna", EEZ),
EEZ = ifelse(EEZ == "French Polynesia", "F. Polynesia", EEZ),
EEZ = ifelse(EEZ == "American Samoa", "Am. Samoa", EEZ),
EEZ = ifelse(EEZ == "Solomon Islands", "Solomon Is.", EEZ))
#eez_dat_L_sth_NoAW_flg %<>% select(-'2010',-'2011')
write.csv(eez_dat_L_sth_NoAW_flg, file = paste0(dir_pth, "Output/LL_Catch_EEZ-By-Flag_ALL_Summary_NoArchWaters.csv"), row.names = FALSE)
#_______________________________________________________________________________
eez_s <- eez_dat_early %>% filter(EEZ %in% cnt, Gear == "L") %>%
mutate(Grp = case_when(EEZ %in% ffa ~ "FFA",
EEZ %in% fra ~ "French",
EEZ %in% us ~ "US",
.default = "High seas"),
Spg = ifelse(EEZ %in% spg, "SPG", "Other"))
ffa_pl <- eez_s %>% group_by(Year, Grp) %>% summarise(Catch = sum(Catch))
ffa_pl$Grp <- factor(ffa_pl$Grp, levels = c("French","US","High seas","FFA"))
windows(4000,2000)
pl1 <- ggplot(ffa_pl, aes(x = factor(Year), y = Catch, fill = Grp)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("goldenrod2","darkorchid","firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl1)
pl2 <- ggplot(ffa_pl, aes(x = factor(Year), y = Catch, fill = Grp)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("goldenrod2","darkorchid","firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl2)
spg_pl <- eez_s %>% group_by(Year, Spg) %>% summarise(Catch = sum(Catch))
spg_pl$Spg <- factor(spg_pl$Spg, levels = c("Other","SPG"))
pl3 <- ggplot(spg_pl, aes(x = factor(Year), y = Catch, fill = Spg)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("firebrick","navy","goldenrod2","darkorchid"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl3)
pl4 <- ggplot(spg_pl, aes(x = factor(Year), y = Catch, fill = Spg)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("firebrick","navy","goldenrod2","darkorchid"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl4)
dev.off()
windows(5000,3000)
plot_grid(pl1, pl2, pl3, pl4, labels = "", ncol = 2)
savePlot(paste0(dir_pth, "Output/Zone_Catch_Breakdown.png"), type="png")
dev.off()
#_______________________________________________________________________________
eez_hs <- eez_dat_early %>% filter(EEZ == "HS", Gear == "L") %>%
mutate(Grp = case_when(Flag %in% ffa ~ "FFA",
.default = "Other"),
Spg = ifelse(Flag %in% spg, "SPG", "Other"))
tmp <- eez_hs %>% group_by(Flag) %>% summarise(Catch = sum(Catch)) %>% arrange(desc(Catch))
cnt_pl <- eez_hs %>% mutate(Flag = ifelse(Flag %in% tmp$Flag[1:11], Flag, "Other")) %>% group_by(Year, Flag) %>% summarise(Catch = sum(Catch))
cnt_pl$Flag <- factor(cnt_pl$Flag, levels = c("Other","BZ","CN","JP","KR","TW","US","SB","KI","CK","FJ","VU"))
windows(4000,2000)
pl1 <- ggplot(cnt_pl, aes(x = factor(Year), y = Catch, fill = Flag)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("dodgerblue2","#E31A1C","green4","#6A3D9A","#FF7F00","black","gold1","skyblue2","#FB9A99", "darkturquoise",
"#CAB2D6",  "#FDBF6F","gray70","khaki2","maroon","orchid1","deeppink1","blue1","steelblue4"), 0.5)) + guides(fill = guide_legend(nrow = 2, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl1)
pl2 <- ggplot(cnt_pl, aes(x = factor(Year), y = Catch, fill = Flag)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("dodgerblue2","#E31A1C","green4","#6A3D9A","#FF7F00","black","gold1","skyblue2","#FB9A99", "darkturquoise",
"#CAB2D6",  "#FDBF6F","gray70","khaki2","maroon","orchid1","deeppink1","blue1","steelblue4"), 0.5)) + guides(fill = guide_legend(nrow = 2, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl2)
# This is the data.frame corresponding to Table 1 of the report - Longline catches by EEZ
dat_hs_flg <- eez_hs %>% ungroup() %>% select(Year,Flag,Catch) %>% mutate(Catch = round(Catch)) %>%
pivot_wider(names_from = Year, values_from = Catch) %>%
mutate(Flag = ez_code$country[match(Flag, ez_code$country_code)])
dat_hs_flg[is.na(dat_hs_flg)] <- 0
dat_hs_flg %<>% ungroup %>% add_row(Flag = "Total", summarise(., across(where(is.numeric), sum))) %>% as.data.frame()
write.csv(dat_hs_flg, file = paste0(dir_pth, "Output/LL_Catch_Highseas_By_Flag.csv"), row.names = FALSE)
ffa_pl <- eez_hs %>% group_by(Year, Grp) %>% summarise(Catch = sum(Catch))
ffa_pl$Grp <- factor(ffa_pl$Grp, levels = c("Other","FFA"))
pl3 <- ggplot(ffa_pl, aes(x = factor(Year), y = Catch, fill = Grp)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl3)
pl4 <- ggplot(ffa_pl, aes(x = factor(Year), y = Catch, fill = Grp)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl4)
spg_pl <- eez_s %>% group_by(Year, Spg) %>% summarise(Catch = sum(Catch))
spg_pl$Spg <- factor(spg_pl$Spg, levels = c("Other","SPG"))
pl5 <- ggplot(spg_pl, aes(x = factor(Year), y = Catch, fill = Spg)) + geom_bar(stat = "identity", width = 1, colour = "black") +
scale_fill_manual(values = alpha(c("firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl5)
pl6 <- ggplot(spg_pl, aes(x = factor(Year), y = Catch, fill = Spg)) + geom_bar(stat = "identity", width = 1, colour = "black", position = "fill") +
scale_fill_manual(values = alpha(c("firebrick","navy"), 0.5)) + guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
scale_x_discrete(breaks = seq(1990,lastyr,2)) + scale_y_continuous(breaks = seq(0,1,.1), labels = comma) +
theme(legend.position = "top", legend.key = element_blank(), legend.background = element_blank(),
legend.box.background = element_blank(), legend.title = element_blank(), axis.title.x = element_blank())
print(pl6)
dev.off()
windows(5000,3000)
plot_grid(pl1, pl2, pl3, pl4, labels = "", ncol = 2)
savePlot(paste0(dir_pth, "Output/HighSeas_Catch_Breakdown_By_Flag.png"), type="png")
dev.off()
windows(5000,4000)
plot_grid(pl1, pl2, pl3, pl4, pl5, pl6, labels = "", ncol = 2)
savePlot(paste0(dir_pth, "Output/HighSeas_Catch_Breakdown_By_Flag_SPG.png"), type="png")
dev.off()
library(RODBC)
library(tidyverse)
library(ggthemes)
base_pth <- "C:/FSM_Request/2023_FADs/"
dat <- read.csv(file = paste0(base_pth, "OP_PS_FM_EEZ.CSV"), header = TRUE) %>% mutate(school = case_when(schas_id %in% 0:2 ~ "UNA",
schas_id %in% 3:8 ~ "ASS"))
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = n())
base_pth
dat <- read.csv(file = paste0(base_pth, "OP_PS_FM_EEZ.CSV"), header = TRUE) %>% mutate(school = case_when(schas_id %in% 0:2 ~ "UNA",
schas_id %in% 3:8 ~ "ASS"))
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = n())
head(dat)
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school)
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = n())
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = dplyr::n())
library(RODBC)
library(tidyverse)
library(ggthemes)
dat <- read.csv(file = paste0(base_pth, "OP_PS_FM_EEZ.CSV"), header = TRUE) %>% mutate(school = case_when(schas_id %in% 0:2 ~ "UNA",
schas_id %in% 3:8 ~ "ASS"))
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = dplyr::n())
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = n())
library(RODBC)
library(ggthemes)
library(tidyverse)
dat <- read.csv(file = paste0(base_pth, "OP_PS_FM_EEZ.CSV"), header = TRUE) %>% mutate(school = case_when(schas_id %in% 0:2 ~ "UNA",
schas_id %in% 3:8 ~ "ASS"))
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = n())
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = dplyr::n())
dat <- read.csv(file = paste0(base_pth, "OP_PS_FM_EEZ.CSV"), header = TRUE) %>% mutate(school = case_when(schas_id %in% 0:2 ~ "UNA",
schas_id %in% 3:8 ~ "ASS"))
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = dplyr::n())
cat_tb <- dat %>% filter(SP_CODE %in% c("BET","SKJ","YFT")) %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>%
summarise(catch = sum(SP_MT))
# 2022 FM flagged FAD sets by each vessel for each month
fm_tb <- dat_tb %>% filter(flag_code == "FM", yr == 2022, school == "ASS") %>% group_by(mth, vesselname) %>% summarise(sets = dplyr::n())
fm_wd <- fm_tb %>% pivot_wider(names_from = vesselname, values_from = sets)
write.csv(fm_wd, file = paste0(base_pth, "FM_PS_2022_FAD_sets_per_month.csv"), row.names = FALSE)
dat <- read.csv(file = paste0(base_pth, "OP_PS_FM_EEZ.CSV"), header = TRUE) %>% mutate(school = case_when(schas_id %in% 0:2 ~ "UNA",
schas_id %in% 3:8 ~ "ASS"))
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = dplyr::n())
cat_tb <- dat %>% filter(SP_CODE %in% c("BET","SKJ","YFT")) %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>%
summarise(catch = sum(SP_MT))
# 2022 FM flagged FAD sets by each vessel for each month
fm_tb <- dat_tb %>% filter(flag_code == "FM", yr == 2022, school == "ASS") %>% group_by(mth, vesselname) %>% summarise(sets = dplyr::n())
fm_wd <- fm_tb %>% pivot_wider(names_from = vesselname, values_from = sets)
write.csv(fm_wd, file = paste0(base_pth, "FM_PS_2022_FAD_sets_per_month.csv"), row.names = FALSE)
# 2021 FM flagged FAD sets by each vessel for each month
fm_tb <- dat_tb %>% filter(flag_code == "FM", yr == 2021, school == "ASS") %>% group_by(mth, vesselname) %>% summarise(sets = dplyr::n())
fm_wd <- fm_tb %>% pivot_wider(names_from = vesselname, values_from = sets)
write.csv(fm_wd, file = paste0(base_pth, "FM_PS_2021_FAD_sets_per_month.csv"), row.names = FALSE)
# 2020 FM flagged FAD sets by each vessel for each month
fm_tb <- dat_tb %>% filter(flag_code == "FM", yr == 2020, school == "ASS") %>% group_by(mth, vesselname) %>% summarise(sets = dplyr::n())
fm_wd <- fm_tb %>% pivot_wider(names_from = vesselname, values_from = sets)
write.csv(fm_wd, file = paste0(base_pth, "FM_PS_2020_FAD_sets_per_month.csv"), row.names = FALSE)
# 2022 JP flagged FAD sets by each vessel for each month
jp_tb <- dat_tb %>% filter(flag_code == "JP", yr == 2022, school == "ASS") %>% group_by(mth, vesselname) %>% summarise(sets = dplyr::n())
jp_wd <- jp_tb %>% pivot_wider(names_from = vesselname, values_from = sets)
write.csv(jp_wd, file = paste0(base_pth, "JP_PS_2022_FAD_sets_per_month.csv"), row.names = FALSE)
# 2022 TW flagged FAD sets by each vessel for each month
tw_tb <- dat_tb %>% filter(flag_code == "TW", yr == 2022, school == "ASS") %>% group_by(mth, vesselname) %>% summarise(sets = dplyr::n())
tw_wd <- tw_tb %>% pivot_wider(names_from = vesselname, values_from = sets)
write.csv(tw_wd, file = paste0(base_pth, "TW_PS_2022_FAD_sets_per_month.csv"), row.names = FALSE)
# Overall monthly summary of FM vessels by year and month
yr_tb <- dat_tb %>% filter(flag_code == "FM", school == "ASS") %>% group_by(yr, mth, vesselname) %>%
summarise(sets = n()) %>% group_by(yr, mth) %>% summarise(Nves = dplyr::n(), avg_sets = mean(sets), total_sets = sum(sets))
yr_tb %<>% mutate(yrmth = yr + (mth - .5)/12)
yr_tb %<>% mutate(yrmth = yr + (mth - .5)/12)
yr_tb <- dat_tb %>% filter(flag_code == "FM", school == "ASS") %>% group_by(yr, mth, vesselname) %>%
summarise(sets = dplyr::n()) %>% group_by(yr, mth) %>% summarise(Nves = dplyr::n(), avg_sets = mean(sets), total_sets = sum(sets))
write.csv(yr_tb, file = paste0(base_pth, "FM_PS_FAD_sets_per_month_summary.csv"), row.names = FALSE)
yr_tb %<>% mutate(yrmth = yr + (mth - .5)/12)
windows(4000,2500)
ggplot(yr_tb, aes(x = yrmth, y = total_sets)) + geom_bar(stat = "identity") +
scale_x_continuous(breaks = seq(min(yr_tb$yr), max(yr_tb$yr), 1)) + theme_bw() +
theme(panel.grid.minor = element_blank())
windows(4000,2500)
ggplot(yr_tb, aes(x = yrmth, y = Nves)) + geom_bar(stat = "identity") +
scale_x_continuous(breaks = seq(min(yr_tb$yr), max(yr_tb$yr), 1)) + theme_bw() +
theme(panel.grid.minor = element_blank())
windows(4000,2500)
ggplot(yr_tb, aes(x = yrmth, y = avg_sets)) + geom_bar(stat = "identity") +
scale_x_continuous(breaks = seq(min(yr_tb$yr), max(yr_tb$yr), 1)) + theme_bw() +
theme(panel.grid.minor = element_blank())
yr_tb <- dat_tb %>% filter(flag_code == "FM") %>% group_by(yr, mth, vesselname, school) %>%
summarise(sets = n()) %>% group_by(yr, mth, school) %>% summarise(Nves = dplyr::n(), avg_sets = mean(sets), total_sets = sum(sets))
yr_tb <- dat_tb %>% filter(flag_code == "FM") %>% group_by(yr, mth, vesselname, school) %>%
summarise(sets = dplyr::n()) %>% group_by(yr, mth, school) %>% summarise(Nves = dplyr::n(), avg_sets = mean(sets), total_sets = sum(sets))
yr_tb %<>% mutate(yrmth = yr + (mth - .5)/12)
windows(4000,2500)
ggplot(yr_tb, aes(x = yrmth, y = total_sets, fill = school)) + geom_bar(stat = "identity", width = 1/12, colour = "grey") +
scale_x_continuous(breaks = seq(min(yr_tb$yr), max(yr_tb$yr), 1)) + theme_bw() +
theme(panel.grid.minor = element_blank()) + scale_fill_manual(values = alpha(c("firebrick","black"),.7))
ggplot(yr_tb, aes(x = yrmth, y = total_sets, fill = school)) + geom_bar(stat = "identity", width = 1/12, colour = "grey", position = "fill") +
scale_x_continuous(breaks = seq(min(yr_tb$yr), max(yr_tb$yr), 1)) + theme_bw() +
theme(panel.grid.minor = element_blank()) + scale_fill_manual(values = alpha(c("firebrick","black"),.7))
yr_tb <- dat_tb %>% filter(flag_code == "JP") %>% group_by(yr, mth, vesselname, school) %>%
summarise(sets = dplyr::n()) %>% group_by(yr, mth, school) %>% summarise(Nves = dplyr::n(), avg_sets = mean(sets), total_sets = sum(sets))
yr_tb %<>% mutate(yrmth = yr + (mth - .5)/12)
windows(4000,2500)
ggplot(yr_tb, aes(x = yrmth, y = total_sets, fill = school)) + geom_bar(stat = "identity", width = 1/12, colour = "grey") +
scale_x_continuous(breaks = seq(min(yr_tb$yr), max(yr_tb$yr), 1)) + theme_bw() +
theme(panel.grid.minor = element_blank()) + scale_fill_manual(values = alpha(c("firebrick","black"),.7))
yr_tb
yr_tb <- dat_tb %>% filter(flag_code == "FM", school == "ASS") %>% group_by(yr, mth, vesselname) %>%
summarise(sets = dplyr::n()) %>% group_by(yr, mth) %>% summarise(Nves = dplyr::n(), avg_sets = mean(sets), total_sets = sum(sets))
write.csv(yr_tb, file = paste0(base_pth, "FM_PS_FAD_sets_per_month_summary.csv"), row.names = FALSE)
yr_tb %<>% mutate(yrmth = yr + (mth - .5)/12)
yr_tb
yr_tb <- dat_tb %>% filter(flag_code == "FM", school == "ASS") %>% group_by(yr, mth, vesselname) %>%
summarise(sets = dplyr::n()) %>% group_by(yr, mth) %>% summarise(Nves = dplyr::n(), avg_sets = mean(sets), total_sets = sum(sets))
write.csv(yr_tb, file = paste0(base_pth, "FM_PS_FAD_sets_per_month_summary.csv"), row.names = FALSE)
yr_tb
yr_tb %<>% mutate(yrmth = yr + (mth - .5)/12)
windows(4000,2500)
ggplot(yr_tb, aes(x = yrmth, y = total_sets)) + geom_bar(stat = "identity", fill = "steelblue") +
scale_x_continuous(breaks = seq(min(yr_tb$yr), max(yr_tb$yr), 1)) + theme_bw() +
theme(panel.grid.minor = element_blank())
yr_tb <- dat_tb %>% filter(flag_code == "FM", school == "ASS") %>% group_by(yr, mth, vesselname) %>%
summarise(sets = dplyr::n()) %>% group_by(yr, mth) %>% summarise(Nves = dplyr::n(), avg_sets = mean(sets), total_sets = sum(sets))
write.csv(yr_tb, file = paste0(base_pth, "FM_PS_FAD_sets_per_month_summary.csv"), row.names = FALSE)
yr_tb %<>% mutate(yrmth = yr + (mth - .5)/12)
windows(4000,2500)
ggplot(yr_tb, aes(x = yrmth, y = total_sets)) + geom_bar(stat = "identity", fill = "steelblue") +
scale_x_continuous(breaks = seq(min(yr_tb$yr), max(yr_tb$yr), 1)) + theme_bw() +
ylab("Number of FAD sets per month") +
theme(panel.grid.minor = element_blank())
head(yr_tb)
library(ggthemes)
library(tidyverse)
dat <- read.csv(file = paste0(base_pth, "OP_PS_FM_EEZ.CSV"), header = TRUE) %>% mutate(school = case_when(schas_id %in% 0:2 ~ "UNA",
schas_id %in% 3:8 ~ "ASS"))
dat_tb <- dat %>% group_by(yr, mth, vessel_instance_id, vesselname, flag_code, LOG_SET_ID, school) %>% summarise(cntr = n())
