facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.1)
windows(4000,3000)
ggplot(reg_dat, aes(x = year, y = med_dep)) + geom_line(linewidth = 2) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.3)
cnt = "CK"
reg_lst
alb_reg_lst <- list("AS" = c(2),
"CK" = c(1,2),
"FJ" = c(2), # Ignored the minute slivers in 1 and 3
"FM" = c(NA), # Ignored FM sliver below equator as they are not typically included in SPA management
"GU" = c(NA),
"KI" = c(1,2),
"MH" = c(NA),
"NC" = c(2,3),
"NR" = c(NA), # Ignored NR sliver below equator as they are not typically included in SPA management
"NU" = c(2),
"PF" = c(1,2,3,4),
"PG" = c(1,2),
"PW" = c(NA),
"SB" = c(1,2),
"TK" = c(1,2),
"TO" = c(2,3),
"TV" = c(1,2),
"WF" = c(2),
"WS" = c(2),
"VU" = c(2))
rep_dat$alb_reg_lst <- alb_reg_lst
rep_dat <- list()
skj_reg_lst <- list("AS" = c(8),
"CK" = c(8),
"FJ" = c(8),
"FM" = c(3,4,5,6,7),
"GU" = c(3,4),
"KI" = c(7,8),
"MH" = c(4,7,8),
"NC" = c(6,7),
"NR" = c(7),
"NU" = c(8),
"PF" = c(8),
"PG" = c(6,7), # I ignored the tiny bit in R5 as no skj in there basically
"PW" = c(3,5),
"SB" = c(6,7,8),
"TK" = c(8),
"TO" = c(8),
"TV" = c(8),
"WF" = c(8),
"WS" = c(8),
"VU" = c(7,8))
rep_dat$skj_reg_lst <- skj_reg_lst
alb_reg_lst <- list("AS" = c(2),
"CK" = c(1,2),
"FJ" = c(2), # Ignored the minute slivers in 1 and 3
"FM" = c(NA), # Ignored FM sliver below equator as they are not typically included in SPA management
"GU" = c(NA),
"KI" = c(1,2),
"MH" = c(NA),
"NC" = c(2,3),
"NR" = c(NA), # Ignored NR sliver below equator as they are not typically included in SPA management
"NU" = c(2),
"PF" = c(1,2,3,4),
"PG" = c(1,2),
"PW" = c(NA),
"SB" = c(1,2),
"TK" = c(1,2),
"TO" = c(2,3),
"TV" = c(1,2),
"WF" = c(2),
"WS" = c(2),
"VU" = c(2))
rep_dat$alb_reg_lst <- alb_reg_lst
yft_reg_lst <- list("AS" = c(5), # Ignored the minute sliver in 4
"CK" = c(4,5),
"FJ" = c(5), # Ignored the minute sliver in 4
"FM" = c(1,2,3,4),
"GU" = c(1),
"KI" = c(4,5),
"MH" = c(1,4),
"NC" = c(5),
"NR" = c(4),
"NU" = c(5),
"PF" = c(5),
"PG" = c(3,4,5),
"PW" = c(2),
"SB" = c(3,4,5),
"TK" = c(4,5),
"TO" = c(5),
"TV" = c(4,5),
"WF" = c(5), # Ignored the minute sliver in 4
"WS" = c(5),
"VU" = c(5))
rep_dat$yft_reg_lst <- yft_reg_lst
bet_reg_lst <- list("AS" = c(6), # Ignored the minute sliver in 4
"CK" = c(4,6),
"FJ" = c(6), # Ignored the minute sliver in 4
"FM" = c(1,3,7,8),
"GU" = c(1),
"KI" = c(3,4,6),
"MH" = c(1,2,3,4),
"NC" = c(5,6),
"NR" = c(3),
"NU" = c(6),
"PF" = c(6),
"PG" = c(3,5,8),
"PW" = c(7),
"SB" = c(3,4,5,8),
"TK" = c(4,6),
"TO" = c(6),
"TV" = c(4,6),
"WF" = c(6), # Ignored the minute sliver in 4
"WS" = c(6),
"VU" = c(5,6))
rep_dat$bet_reg_lst <- bet_reg_lst
reg_lst = alb_reg_lst
reg_lst
cnt_reg <- reg_lst[[cnt]]
cnt_reg
reg_dat$fcl_reg <- ifelse(as.numeric(reg_dat$area) %in% cnt_reg, "focal", "other")
head(reg_dat)
sub_dat <- filter(reg_dat, fcl_reg == "focal")
sub_dat
windows(4000,3000)
ggplot(reg_dat, aes(x = year, y = med_dep)) + geom_line(linewidth = 2) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.3)
windows(4000,3000)
ggplot(reg_dat, aes(x = year, y = med_dep)) + geom_line(linewidth = 2) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.3)
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("sb/sbf=0") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
ggplot(reg_dat, aes(x = year, y = med_dep)) + geom_line(linewidth = 2) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.3) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("sb/sbf=0") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
library(ggthemes)
ggplot(reg_dat, aes(x = year, y = med_dep)) + geom_line(linewidth = 2) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.3) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("sb/sbf=0") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
ggplot(reg_dat, aes(x = year, y = med_dep)) + geom_line(linewidth = 2) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("sb/sbf=0") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
ggplot(reg_dat, aes(x = year, y = med_dep)) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
geom_line(linewidth = 2) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("sb/sbf=0") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
windows(4000,3000)
ggplot(reg_dat, aes(x = year, y = med_dep)) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
geom_line(linewidth = 2) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("sb/sbf=0") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
.21/.205
35000*.005
extract_depletion <- function(mod_folder = "S1M1D1R1G1", scl = "full",
rundir = "//penguin/assessments/alb/2021/backupCCJ/ALB21_Projections/",
finalpar = "plot-final3.par.rep"){
rawrep <- paste0(rundir, mod_folder, "/", finalpar)
readrep <- read.MFCLRep(rawrep)
if(scl == "full"){
dep_yr <- as.data.frame(seasonMeans(areaSums(adultBiomass(readrep)))/seasonMeans(areaSums(adultBiomass_nofish(readrep))))
} else{
dep_yr <- as.data.frame(seasonMeans(adultBiomass(readrep))/seasonMeans(adultBiomass_nofish(readrep)))
}
dep_yr <- mutate(dep_yr, mod = mod_folder)
return(dep_yr)
}
full_dep <- map(list.files(path=rundir, pattern="S", full.names=F, ignore.case=TRUE),
extract_depletion, scl = "full",
rundir = "//penguin/assessments/alb/2021/backupCCJ/ALB21_Projections/",
finalpar = "plot-final3.par.rep")
View(full_dep_df)
full_dep <- rbindlist(full_dep)
full_dep <- full_dep %>% group_by(year) %>% summarise(dep = median(data))
head(full_dep)
full_dep <- map(list.files(path=rundir, pattern="S", full.names=F, ignore.case=TRUE),
extract_depletion, scl = "full",
rundir = "//penguin/assessments/alb/2021/backupCCJ/ALB21_Projections/",
finalpar = "plot-final3.par.rep")
str(full_de[])
str(full_dep_df)
full_dep <- rbindlist(full_dep)
head(full_dep)
sessionInfo()
full_dep <- map(list.files(path=rundir, pattern="S", full.names=F, ignore.case=TRUE),
extract_depletion, scl = "full",
rundir = "//penguin/assessments/alb/2021/backupCCJ/ALB21_Projections/",
finalpar = "plot-final3.par.rep")
head(full_dep_df)
head(full_dep)
full_dep_df <- rbindlist(full_dep)
head(full_dep_df)
full_dep_df
tail(full_dep)
tail(full_dep[[1]])
rundir <- "//penguin/assessments/alb/2021/backupCCJ/ALB21_Projections/"
gridruns <- list.files(path=rundir, pattern="S", full.names=F, ignore.case=TRUE)
extract_depletion <- function(mod_folder = "S1M1D1R1G1", scl = "full",
rundir = "//penguin/assessments/alb/2021/backupCCJ/ALB21_Projections/",
finalpar = "plot-final3.par.rep"){
rawrep <- paste0(rundir, mod_folder, "/", finalpar)
readrep <- read.MFCLRep(rawrep)
if(scl == "full"){
dep_yr <- as.data.frame(seasonMeans(areaSums(adultBiomass(readrep)))/seasonMeans(areaSums(adultBiomass_nofish(readrep))))
} else{
dep_yr <- as.data.frame(seasonMeans(adultBiomass(readrep))/seasonMeans(adultBiomass_nofish(readrep)))
}
dep_yr <- mutate(dep_yr, mod = mod_folder)
return(dep_yr)
}
full_dep <- map(gridruns, extract_depletion, scl = "full",
rundir = "//penguin/assessments/alb/2021/backupCCJ/ALB21_Projections/",
finalpar = "plot-final3.par.rep")
str(full_dep)
10.5/9.23
.26/.25
.26/.25*7000
.265/.25*7000
220/4.5
220/5
220/5.5
220/6
36/4.5
388*(52/4)
394838*.028
70299*.185
70299*.19
70299*.195
.265/.25
.265/.25*7000
.185/.18
library(ggplot2)
library(magrittr)
library(tidyverse)
library(ggthemes)
library(FLR4MFCL)
library(readr)
library(xtable)
rep_dat <- list()
#yr1 <- 2014
lst_yr <- 2022
cnt_vec <- c("AS","CK","FJ","FM","GU","KI","MH","NC","NR","NU","PF","PG","PW","SB","TK","TO","TV","WF","WS","VU")
# Exclude Guam?
skj_reg_lst <- list("AS" = c(8),
"CK" = c(8),
"FJ" = c(8),
"FM" = c(3,4,5,6,7),
"GU" = c(3,4),
"KI" = c(7,8),
"MH" = c(4,7,8),
"NC" = c(6,7),
"NR" = c(7),
"NU" = c(8),
"PF" = c(8),
"PG" = c(6,7), # I ignored the tiny bit in R5 as no skj in there basically
"PW" = c(3,5),
"SB" = c(6,7,8),
"TK" = c(8),
"TO" = c(8),
"TV" = c(8),
"WF" = c(8),
"WS" = c(8),
"VU" = c(7,8))
rep_dat$skj_reg_lst <- skj_reg_lst
alb_reg_lst <- list("AS" = c(2),
"CK" = c(1,2),
"FJ" = c(2), # Ignored the minute slivers in 1 and 3
"FM" = c(NA), # Ignored FM sliver below equator as they are not typically included in SPA management
"GU" = c(NA),
"KI" = c(1,2),
"MH" = c(NA),
"NC" = c(2,3),
"NR" = c(NA), # Ignored NR sliver below equator as they are not typically included in SPA management
"NU" = c(2),
"PF" = c(1,2,3,4),
"PG" = c(1,2),
"PW" = c(NA),
"SB" = c(1,2),
"TK" = c(1,2),
"TO" = c(2,3),
"TV" = c(1,2),
"WF" = c(2),
"WS" = c(2),
"VU" = c(2))
rep_dat$alb_reg_lst <- alb_reg_lst
yft_reg_lst <- list("AS" = c(5), # Ignored the minute sliver in 4
"CK" = c(4,5),
"FJ" = c(5), # Ignored the minute sliver in 4
"FM" = c(1,2,3,4),
"GU" = c(1),
"KI" = c(4,5),
"MH" = c(1,4),
"NC" = c(5),
"NR" = c(4),
"NU" = c(5),
"PF" = c(5),
"PG" = c(3,4,5),
"PW" = c(2),
"SB" = c(3,4,5),
"TK" = c(4,5),
"TO" = c(5),
"TV" = c(4,5),
"WF" = c(5), # Ignored the minute sliver in 4
"WS" = c(5),
"VU" = c(5))
rep_dat$yft_reg_lst <- yft_reg_lst
bet_reg_lst <- list("AS" = c(6), # Ignored the minute sliver in 4
"CK" = c(4,6),
"FJ" = c(6), # Ignored the minute sliver in 4
"FM" = c(1,3,7,8),
"GU" = c(1),
"KI" = c(3,4,6),
"MH" = c(1,2,3,4),
"NC" = c(5,6),
"NR" = c(3),
"NU" = c(6),
"PF" = c(6),
"PG" = c(3,5,8),
"PW" = c(7),
"SB" = c(3,4,5,8),
"TK" = c(4,6),
"TO" = c(6),
"TV" = c(4,6),
"WF" = c(6), # Ignored the minute sliver in 4
"WS" = c(6),
"VU" = c(5,6))
rep_dat$bet_reg_lst <- bet_reg_lst
base_pth <- "./"
alb_rep <- read.MFCLRep("./Data/ALB/plot-final3.par.rep")
bet_rep <- read.MFCLRep("./Data/BET/plot-09.par.rep")
skj_rep <- read.MFCLRep("./Data/SKJ/plot-09.par.rep")
yft_rep <- read.MFCLRep("./Data/YFT/plot-14.par.rep")
extract_depletion <- function(mod_folder = "S1M1D1R1G1", scl = "full",
rundir = "//penguin/assessments/alb/2021/backupCCJ/ALB21_Projections/",
finalpar = "plot-final3.par.rep"){
rawrep <- paste0(rundir, mod_folder, "/", finalpar)
readrep <- read.MFCLRep(rawrep)
if(scl == "full"){
dep_yr <- as.data.frame(seasonMeans(areaSums(adultBiomass(readrep)))/seasonMeans(areaSums(adultBiomass_nofish(readrep))))
} else{
dep_yr <- as.data.frame(seasonMeans(adultBiomass(readrep))/seasonMeans(adultBiomass_nofish(readrep)))
}
dep_yr <- mutate(dep_yr, mod = mod_folder)
return(dep_yr)
}
# Process albacore grid runs to extract depletion at full and region level
tmpdir <- "//penguin/assessments/alb/2021/backupCCJ/ALB21_Projections/"
full_dep_alb <- map(list.files(path = tmpdir, pattern = "S", full.names = FALSE, ignore.case = TRUE),  extract_depletion, scl = "full",
rundir = tmpdir, finalpar = "plot-final3.par.rep")
str(full_dep_alb)
reg_dep_alb <- map(list.files(path = tmpdir, pattern = "S", full.names = FALSE, ignore.case = TRUE), extract_depletion, scl = "regional",
rundir = tmpdir, finalpar = "plot-final3.par.rep")
full_dat = full_dep_alb
reg_dat = reg_dep_alb
reg_lst = skj_reg_lst
cnt = "CK"
spp = "alb"
cnt_reg <- reg_lst[[cnt]]
cnt_reg
reg_lst = alb_reg_lst
cnt_reg <- reg_lst[[cnt]]
cnt_reg
full_dat <- rbindlist(full_dat)
head(full_dat)
tail(full_dat)
full_dat <- full_dat %>% group_by(year) %>% summarise(dep = median(data))
full_dat
.48/.46
full_dat = full_dep_alb
full_dat <- rbindlist(full_dat)
full_dat <- full_dat %>% group_by(year) %>% summarise(dep = median(data), LL_dep = quantile(data, .1), UL_dep = quantile(data, .9))
full_dat
windows(4000,3000)
ggplot(full_dat, aes(x = year, y = dep)) + geom_line(linewidth = 2)
windows(4000,3000)
ggplot(full_dat, aes(x = year, y = dep)) + geom_line(linewidth = 2) +
geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("sb/sbf=0") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
windows(4000,3000)
ggplot(full_dat, aes(x = year, y = dep)) +
geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
geom_line(linewidth = 2) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("sb/sbf=0") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
reg_dat <- rbindlist(reg_dat)
reg_dat <- reg_dat %>% group_by(year, area) %>%
summarise(med_dep = median(data), LL_dep = quantile(data, .1), UL_dep = quantile(data, .9))
reg_dep$fcl_reg <- ifelse(as.numeric(reg_dep$area) %in% cnt_reg, "focal", "other")
sub_dat <- filter(reg_dep, fcl_reg == "focal")
reg_dat = reg_dep_alb
reg_dat <- rbindlist(reg_dat)
reg_dat <- reg_dat %>% group_by(year, area) %>%
summarise(med_dep = median(data), LL_dep = quantile(data, .1), UL_dep = quantile(data, .9))
reg_dat$fcl_reg <- ifelse(as.numeric(reg_dat$area) %in% cnt_reg, "focal", "other")
sub_dat <- filter(reg_dat, fcl_reg == "focal")
windows(4000,3000)
ggplot(reg_dat, aes(x = year, y = med_dep)) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
geom_line(linewidth = 2) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("Depletion (sb/sbf=0)") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
.78/.77
.475/.46
.475/.46*7000
plot_regional_depletion <- function(full_dat = full_dep_alb, reg_dat = reg_dep_alb,
reg_lst = alb_reg_lst, cnt = "CK", spp = "alb"){
cnt_reg <- reg_lst[[cnt]]
full_dat <- rbindlist(full_dat)
full_dat <- full_dat %>% group_by(year) %>% summarise(dep = median(data), LL_dep = quantile(data, .1), UL_dep = quantile(data, .9))
windows(4000,3000)
ggplot(full_dat, aes(x = year, y = dep)) +
geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
geom_line(linewidth = 2) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("Depletion (sb/sbf=0)") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
savePlot(paste0("Figures/", cnt, "/full_depletion_", spp, ".png"), type="png")
dev.off()
reg_dat <- rbindlist(reg_dat)
reg_dat <- reg_dat %>% group_by(year, area) %>%
summarise(med_dep = median(data), LL_dep = quantile(data, .1), UL_dep = quantile(data, .9))
reg_dat$fcl_reg <- ifelse(as.numeric(reg_dat$area) %in% cnt_reg, "focal", "other")
sub_dat <- filter(reg_dat, fcl_reg == "focal")
windows(4000,3000)
ggplot(reg_dat, aes(x = year, y = med_dep)) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
geom_line(linewidth = 2) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("Depletion (sb/sbf=0)") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
savePlot(paste0("Figures/", cnt, "/regional_depletion_", spp, ".png"), type="png")
dev.off()
}
map(cnt_vec, plot_regional_depletion, full_dat = full_dep_alb, reg_dat = reg_dep_alb, reg_lst = alb_reg_lst, spp = "alb")
1.5/1.46
1.51/1.46
1.51/1.46*7000
# Process albacore grid runs to extract depletion at full and region level
tmpdir <- "//penguin/assessments/alb/2021/backupCCJ/ALB21_Projections/"
full_dep_alb <- map(list.files(path = tmpdir, pattern = "S", full.names = FALSE, ignore.case = TRUE),  extract_depletion, scl = "full",
rundir = tmpdir, finalpar = "plot-final3.par.rep")
reg_dep_alb <- map(list.files(path = tmpdir, pattern = "S", full.names = FALSE, ignore.case = TRUE), extract_depletion, scl = "regional",
rundir = tmpdir, finalpar = "plot-final3.par.rep")
plot_depletion <- function(full_dat = full_dep_alb, reg_dat = reg_dep_alb,
reg_lst = alb_reg_lst, cnt = "CK", spp = "alb"){
cnt_reg <- reg_lst[[cnt]]
full_dat <- rbindlist(full_dat)
full_dat <- full_dat %>% group_by(year) %>% summarise(dep = median(data), LL_dep = quantile(data, .1), UL_dep = quantile(data, .9))
windows(4000,3000)
ggplot(full_dat, aes(x = year, y = dep)) +
geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
geom_line(linewidth = 2) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("Depletion (sb/sbf=0)") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
savePlot(paste0("Figures/", cnt, "/full_depletion_", spp, ".png"), type="png")
dev.off()
reg_dat <- rbindlist(reg_dat)
reg_dat <- reg_dat %>% group_by(year, area) %>%
summarise(med_dep = median(data), LL_dep = quantile(data, .1), UL_dep = quantile(data, .9))
reg_dat$fcl_reg <- ifelse(as.numeric(reg_dat$area) %in% cnt_reg, "focal", "other")
sub_dat <- filter(reg_dat, fcl_reg == "focal")
windows(4000,3000)
ggplot(reg_dat, aes(x = year, y = med_dep)) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
geom_line(linewidth = 2) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("Depletion (sb/sbf=0)") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
savePlot(paste0("Figures/", cnt, "/regional_depletion_", spp, ".png"), type="png")
dev.off()
}
map(cnt_vec, plot_depletion, full_dat = full_dep_alb, reg_dat = reg_dep_alb, reg_lst = alb_reg_lst, spp = "alb")
full_dat = full_dep_alb
reg_dat = reg_dep_alb
reg_lst = alb_reg_lst
cnt = "CK"
spp = "alb"
cnt_reg <- reg_lst[[cnt]]
full_dat <- rbindlist(full_dat)
full_dat <- full_dat %>% group_by(year) %>% summarise(dep = median(data), LL_dep = quantile(data, .1), UL_dep = quantile(data, .9))
head(full_dat)
windows(4000,3000)
ggplot(full_dat, aes(x = year, y = dep)) +
geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
geom_line(linewidth = 2) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("Depletion (sb/sbf=0)") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
(paste0("Figures/", cnt, "/full_depletion_", spp, ".png")
paste0("Figures/", cnt, "/full_depletion_", spp, ".png")
savePlot(paste0("Figures/", cnt, "/full_depletion_", spp, ".png"), type="png")
reg_dat <- rbindlist(reg_dat)
reg_dat <- reg_dat %>% group_by(year, area) %>%
summarise(med_dep = median(data), LL_dep = quantile(data, .1), UL_dep = quantile(data, .9))
reg_dat$fcl_reg <- ifelse(as.numeric(reg_dat$area) %in% cnt_reg, "focal", "other")
sub_dat <- filter(reg_dat, fcl_reg == "focal")
windows(4000,3000)
ggplot(reg_dat, aes(x = year, y = med_dep)) +
geom_rect(data = sub_dat, fill = alpha("springgreen4", 0.005), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
facet_wrap(~ area, ncol = 2) + geom_ribbon(aes(ymin = LL_dep, ymax = UL_dep), fill = "dodgerblue", alpha=0.6) +
geom_line(linewidth = 2) +
scale_y_continuous(breaks = seq(0, 1, .2), limits = c(0, 1)) + xlab("") + ylab("Depletion (sb/sbf=0)") + geom_hline(yintercept = 0.2, colour = alpha("red", 0.7), linetype = 2) +
theme_clean()
savePlot(paste0("Figures/", cnt, "/regional_depletion_", spp, ".png"), type="png")
151000+66601+8000+45000/.92
